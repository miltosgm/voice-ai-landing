<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sofia Dialer ‚Äî Growth-onomics</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f5f5fa;
    --surface: #ffffff;
    --border: rgba(0,0,0,0.07);
    --accent: #6c47ff;
    --accent2: #9b7fff;
    --green: #059669;
    --green-dim: rgba(5,150,105,0.1);
    --red: #e17055;
    --red-dim: rgba(225,112,85,0.1);
    --yellow: #d97706;
    --yellow-dim: rgba(217,119,6,0.1);
    --white: #1a1a2e;
    --gray: #6b7280;
    --gray2: #d1d5db;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--white);
    min-height: 100vh;
    padding: 32px 20px 80px;
  }
  body::before { display: none; }

  /* Outcome modal buttons */
  .outcome-btn { width:100%;padding:11px 16px;border-radius:12px;font-size:14px;font-weight:600;cursor:pointer;font-family:'Inter',sans-serif;text-align:left;transition:opacity 0.15s; }
  .outcome-btn:hover { opacity:0.8; }

  /* Settings drawer */
  .sdrawer-section { border-bottom:1px solid var(--border);padding-bottom:18px;margin-bottom:18px; }
  .sdrawer-label { font-size:13px;font-weight:700;margin-bottom:10px;color:var(--white); }
  .sdrawer-input { width:100%;border:1px solid var(--border);border-radius:10px;padding:8px 12px;font-size:12px;font-family:inherit;outline:none;color:var(--white);background:var(--bg);transition:border-color 0.2s; }
  .sdrawer-input:focus { border-color:var(--accent); }
  .day-check { display:flex;align-items:center;gap:4px;font-size:12px;color:var(--gray);cursor:pointer;padding:4px 8px;border:1px solid var(--border);border-radius:8px;background:var(--bg); }
  .day-check input { cursor:pointer; }

  /* Campaign badge */
  .campaign-badge { display:inline-block;font-size:10px;font-weight:600;padding:2px 8px;border-radius:20px;background:rgba(108,92,231,0.12);color:var(--accent2);border:1px solid rgba(108,92,231,0.2);margin-left:6px;vertical-align:middle; }

  /* Sidebar logo */
  #sb-logo-img { max-height:32px;object-fit:contain;margin-bottom:8px;display:none; }

  .page { position: relative; z-index: 1; max-width: 680px; margin: 0 auto; }

  /* HEADER */
  .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 40px; }
  .brand { font-size: 12px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; color: var(--gray); }
  .brand span { color: var(--accent2); }
  .badge {
    font-size: 11px; font-weight: 600; padding: 4px 12px; border-radius: 20px;
    background: var(--green-dim); color: var(--green); border: 1px solid rgba(0,184,148,0.2);
    display: flex; align-items: center; gap: 6px;
  }
  .badge::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: blink 2s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* HERO */
  .hero {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 20px; padding: 28px 24px;
    display: flex; align-items: center; gap: 20px; margin-bottom: 20px;
  }
  .sofia-avatar-sm {
    width: 72px; height: 72px; border-radius: 50%;
    background: linear-gradient(135deg, #3d3580, #6c5ce7, #a29bfe);
    display: flex; align-items: center; justify-content: center; font-size: 32px;
    flex-shrink: 0; box-shadow: 0 0 32px rgba(108,92,231,0.3);
  }
  .sofia-info { flex: 1; }
  .sofia-name { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
  .sofia-title { font-size: 13px; color: var(--gray); margin-bottom: 10px; }
  .sofia-title span { color: var(--accent2); }
  .sofia-tags { display: flex; flex-wrap: wrap; gap: 6px; }
  .tag { font-size: 11px; font-weight: 500; padding: 3px 10px; border-radius: 20px; background: rgba(108,92,231,0.12); color: var(--accent2); border: 1px solid rgba(108,92,231,0.2); }

  /* AGENT SELECTOR */
  .agent-selector { display: flex; gap: 10px; margin-bottom: 20px; }
  .agent-card {
    flex: 1; padding: 14px 16px;
    background: rgba(255,255,255,0.03); border: 1px solid var(--border);
    border-radius: 14px; cursor: pointer; transition: all 0.2s; text-align: left;
  }
  .agent-card:hover { border-color: var(--accent); }
  .agent-card.editing {
    border-color: var(--accent);
    background: rgba(108,92,231,0.12);
    cursor: text;
  }
  .agent-card-name[contenteditable],
  .agent-card-desc[contenteditable] {
    outline: none;
    border-radius: 4px;
    padding: 2px 4px;
    background: rgba(255,255,255,0.05);
    cursor: text;
  }
  .agent-card-name[contenteditable]:focus,
  .agent-card-desc[contenteditable]:focus {
    background: rgba(108,92,231,0.2);
    border: 1px solid var(--accent);
  }
  .edit-controls {
    display: none;
    gap: 6px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }
  .agent-card.editing .edit-controls {
    display: flex;
  }
  .btn-edit-save, .btn-edit-cancel {
    flex: 1;
    padding: 6px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: rgba(255,255,255,0.04);
    color: var(--gray);
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-edit-save:hover {
    border-color: var(--green);
    color: var(--green);
    background: rgba(0,184,148,0.1);
  }
  .btn-edit-cancel:hover {
    border-color: var(--red);
    color: var(--red);
    background: rgba(225,112,85,0.1);
  }
  .agent-card.active {
    border-color: var(--accent);
    background: rgba(108,92,231,0.08);
    box-shadow: 0 0 0 1px rgba(108,92,231,0.3);
  }
  .agent-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
  .agent-emoji { font-size: 22px; }
  .agent-card-name { font-size: 14px; font-weight: 700; color: var(--white); }
  .agent-card-desc { font-size: 11px; color: var(--gray); line-height: 1.5; }
  .agent-card.active .agent-card-name { color: var(--accent2); }
  .agent-active-dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--accent2); margin-left: auto; flex-shrink: 0;
    opacity: 0;
  }
  .agent-card.active .agent-active-dot { opacity: 1; }

  /* MODE TABS */
  .mode-tabs {
    display: flex; gap: 0;
    background: rgba(255,255,255,0.03); border: 1px solid var(--border);
    border-radius: 14px; padding: 4px; margin-bottom: 20px;
  }
  .mode-tab {
    flex: 1; padding: 12px 16px; border: none; border-radius: 10px;
    background: transparent; color: var(--gray);
    font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .mode-tab.active { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; box-shadow: 0 4px 16px rgba(108,92,231,0.35); }
  .mode-tab:not(.active):hover { color: var(--accent2); }

  /* LANGUAGE TOGGLE */
  .lang-toggle {
    display: flex; gap: 0;
    background: rgba(255,255,255,0.04); border: 1px solid var(--border);
    border-radius: 12px; padding: 4px; margin-bottom: 20px;
  }
  .lang-btn {
    flex: 1; padding: 10px 16px; border: none; border-radius: 8px;
    background: transparent; color: var(--gray);
    font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .lang-btn.active { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; box-shadow: 0 4px 12px rgba(108,92,231,0.3); }
  .lang-btn:not(.active):hover { color: var(--accent2); }

  /* ‚îÄ‚îÄ BROWSER CALL SECTION ‚îÄ‚îÄ */
  .browser-section { display: none; }
  .browser-section.active { display: block; }

  .browser-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 20px; padding: 40px 24px 32px;
    display: flex; flex-direction: column; align-items: center;
    margin-bottom: 20px; text-align: center;
  }

  .avatar-wrap { position: relative; margin-bottom: 28px; }
  .avatar-lg {
    width: 110px; height: 110px; border-radius: 50%;
    background: linear-gradient(135deg, #3d3580, #6c5ce7, #a29bfe);
    display: flex; align-items: center; justify-content: center; font-size: 48px;
    position: relative; z-index: 2;
    box-shadow: 0 0 0 8px rgba(108,92,231,0.08), 0 0 60px rgba(108,92,231,0.25);
    transition: box-shadow 0.4s;
  }
  .avatar-lg.speaking {
    box-shadow: 0 0 0 8px rgba(108,92,231,0.15), 0 0 80px rgba(108,92,231,0.5);
    animation: pulse-glow 1.5s ease-in-out infinite;
  }
  @keyframes pulse-glow {
    0%,100% { box-shadow: 0 0 0 8px rgba(108,92,231,0.15), 0 0 60px rgba(108,92,231,0.3); }
    50% { box-shadow: 0 0 0 16px rgba(108,92,231,0.08), 0 0 100px rgba(108,92,231,0.5); }
  }
  .online-dot {
    position: absolute; bottom: 6px; right: 6px;
    width: 18px; height: 18px; border-radius: 50%;
    background: var(--green); border: 3px solid var(--bg); z-index: 3;
  }
  .online-dot.busy { background: var(--accent2); animation: blink 1s infinite; }
  .online-dot.ended { background: var(--gray); }

  .wave-wrap { height: 40px; display: flex; align-items: center; justify-content: center; gap: 5px; margin: 0 0 20px; opacity: 0; transition: opacity 0.4s; }
  .wave-wrap.visible { opacity: 1; }
  .wave-bar { width: 4px; border-radius: 2px; background: linear-gradient(to top, var(--accent), var(--accent2)); animation: wave 1.2s ease-in-out infinite; }
  .wave-bar:nth-child(1) { height: 10px; animation-delay: 0s; }
  .wave-bar:nth-child(2) { height: 20px; animation-delay: 0.1s; }
  .wave-bar:nth-child(3) { height: 34px; animation-delay: 0.2s; }
  .wave-bar:nth-child(4) { height: 24px; animation-delay: 0.15s; }
  .wave-bar:nth-child(5) { height: 34px; animation-delay: 0.25s; }
  .wave-bar:nth-child(6) { height: 20px; animation-delay: 0.1s; }
  .wave-bar:nth-child(7) { height: 10px; animation-delay: 0.05s; }
  .wave-bar.idle { animation: none; height: 4px !important; opacity: 0.3; }
  @keyframes wave { 0%,100% { transform: scaleY(0.3); opacity: 0.5; } 50% { transform: scaleY(1); opacity: 1; } }

  .call-timer { font-size: 15px; font-weight: 300; letter-spacing: 3px; color: var(--white); margin-bottom: 8px; font-variant-numeric: tabular-nums; opacity: 0; transition: opacity 0.3s; }
  .call-timer.visible { opacity: 1; }
  .call-status { font-size: 14px; color: var(--gray); margin-bottom: 28px; transition: color 0.3s; }
  .call-status.active { color: var(--accent2); }

  .btn-talk {
    width: 100%; max-width: 340px; padding: 18px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none; border-radius: 16px; color: white;
    font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 600;
    cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
    transition: all 0.2s; box-shadow: 0 8px 32px rgba(108,92,231,0.3); margin-bottom: 12px;
  }
  .btn-talk:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(108,92,231,0.45); }
  .btn-talk:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-end-call {
    width: 100%; max-width: 340px; padding: 15px;
    background: var(--red-dim); border: 1px solid rgba(225,112,85,0.3);
    border-radius: 16px; color: var(--red);
    font-family: 'Inter', sans-serif; font-size: 15px; font-weight: 600;
    cursor: pointer; display: none; align-items: center; justify-content: center; gap: 8px;
    transition: all 0.2s; margin-bottom: 12px;
  }
  .btn-end-call:hover { background: rgba(225,112,85,0.2); }
  .btn-end-call.show { display: flex; }

  /* ‚îÄ‚îÄ PHONE SECTION ‚îÄ‚îÄ */
  .phone-section { display: none; }
  .phone-section.active { display: block; }

  /* OPENER PREVIEW */
  .opener-preview {
    background: rgba(108,92,231,0.06); border: 1px solid rgba(108,92,231,0.15);
    border-left: 3px solid var(--accent); border-radius: 12px;
    padding: 14px 16px; margin-bottom: 20px;
    font-size: 13px; color: rgba(240,240,255,0.65); font-style: italic; line-height: 1.6;
  }
  .opener-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--gray); margin-bottom: 6px; }

  /* CUSTOMIZE */
  .customize-toggle {
    width: 100%; background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 16px 20px; color: var(--gray);
    font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 500;
    cursor: pointer; display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 0; transition: all 0.2s; text-align: left;
  }
  .customize-toggle:hover { border-color: var(--accent); color: var(--accent2); }
  .customize-toggle.open { border-radius: 16px 16px 0 0; border-color: var(--accent); color: var(--accent2); }
  .toggle-left { display: flex; align-items: center; gap: 10px; }
  .toggle-arrow { font-size: 12px; transition: transform 0.25s; }
  .toggle-arrow.open { transform: rotate(180deg); }
  .modified-badge { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 20px; background: rgba(253,203,110,0.12); color: var(--yellow); border: 1px solid rgba(253,203,110,0.2); display: none; }
  .modified-badge.show { display: inline-block; }

  .customize-body {
    background: var(--surface); border: 1px solid var(--accent); border-top: none;
    border-radius: 0 0 16px 16px; padding: 20px; margin-bottom: 20px; display: none;
  }
  .customize-body.open { display: block; }

  .field-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--gray); margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; }
  .field-hint { font-size: 10px; color: var(--gray2); font-weight: 400; text-transform: none; letter-spacing: 0; }
  .custom-textarea {
    width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border);
    border-radius: 10px; color: var(--white); font-family: 'Inter', sans-serif;
    font-size: 13px; line-height: 1.6; padding: 12px 14px; outline: none;
    resize: vertical; transition: border-color 0.2s; min-height: 72px;
  }
  .custom-textarea:focus { border-color: var(--accent); }
  .custom-textarea.system-prompt { min-height: 280px; font-size: 12px; }
  .custom-textarea::placeholder { color: var(--gray2); }
  .field-sep { border: none; border-top: 1px solid var(--border); margin: 18px 0; }
  .reset-row { display: flex; justify-content: flex-end; gap: 8px; margin-top: 14px; }
  .btn-reset { font-size: 12px; font-weight: 500; padding: 7px 14px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--gray); cursor: pointer; font-family: 'Inter', sans-serif; transition: all 0.2s; }
  .btn-reset:hover { border-color: var(--red); color: var(--red); }
  .btn-save-prompt { font-size: 12px; font-weight: 600; padding: 7px 16px; border-radius: 8px; border: none; background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; cursor: pointer; font-family: 'Inter', sans-serif; transition: all 0.2s; box-shadow: 0 3px 12px rgba(108,92,231,0.3); }
  .btn-save-prompt:hover { transform: translateY(-1px); }

  /* CARDS */
  .card { background: #ffffff; border: 1px solid var(--border); border-radius: 20px; padding: 24px; margin-bottom: 20px; }
  .card-title { font-size: 14px; font-weight: 600; color: var(--white); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }

  /* INPUTS */
  .phone-row { display: flex; gap: 10px; margin-bottom: 12px; }
  .country-select { background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 12px; color: var(--white); font-family: 'Inter', sans-serif; font-size: 14px; padding: 14px 12px; cursor: pointer; outline: none; transition: border-color 0.2s; flex-shrink: 0; }
  .country-select:focus { border-color: var(--accent); }
  .country-select option { background: #f0f0f8; }
  .phone-input { flex: 1; background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 12px; color: var(--white); font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 500; padding: 14px 16px; outline: none; transition: border-color 0.2s; letter-spacing: 1px; }
  .phone-input::placeholder { color: var(--gray); font-weight: 400; letter-spacing: 0; font-size: 14px; }
  .phone-input:focus { border-color: var(--accent); }
  .name-input { width: 100%; background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 12px; color: var(--white); font-family: 'Inter', sans-serif; font-size: 14px; padding: 12px 16px; outline: none; transition: border-color 0.2s; margin-bottom: 12px; }
  .name-input::placeholder { color: var(--gray); }
  .name-input:focus { border-color: var(--accent); }

  .btn-row { display: flex; gap: 10px; }
  .btn-add { flex: 1; padding: 14px; background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 12px; color: var(--gray); font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
  .btn-add:hover { border-color: var(--accent); color: var(--accent2); }
  .btn-call-now { flex: 2; padding: 14px; background: linear-gradient(135deg, var(--accent), var(--accent2)); border: none; border-radius: 12px; color: white; font-family: 'Inter', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; box-shadow: 0 6px 24px rgba(108,92,231,0.3); }
  .btn-call-now:hover { transform: translateY(-1px); box-shadow: 0 10px 32px rgba(108,92,231,0.45); }
  .btn-call-now:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* QUEUE */
  .queue-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .queue-count { font-size: 12px; font-weight: 600; padding: 3px 10px; border-radius: 20px; background: rgba(108,92,231,0.12); color: var(--accent2); }
  .btn-call-all { padding: 10px 20px; background: linear-gradient(135deg, var(--accent), var(--accent2)); border: none; border-radius: 10px; color: white; font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 16px rgba(108,92,231,0.3); }
  .btn-call-all:hover { transform: translateY(-1px); }
  .btn-call-all:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .queue-empty { text-align: center; color: var(--gray); font-size: 14px; padding: 32px 0; }
  .contact-item { display:flex; align-items:center; gap:10px; padding:9px 12px; border-radius:10px; border:1px solid var(--border); background:var(--surface); }
  .contact-avatar { width:32px; height:32px; border-radius:50%; background:rgba(108,92,231,0.12); display:flex; align-items:center; justify-content:center; font-size:13px; font-weight:700; color:var(--accent2); flex-shrink:0; }
  .contact-info { flex:1; min-width:0; }
  .contact-name { font-size:13px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .contact-number { font-size:11px; color:var(--gray); margin-top:1px; }
  .contact-actions { display:flex; gap:6px; flex-shrink:0; }
  .contact-btn { font-size:11px; padding:4px 10px; border-radius:8px; border:none; cursor:pointer; font-family:inherit; font-weight:600; transition:all 0.15s; }
  .contact-btn.call { background:var(--green-dim); color:var(--green); }
  .contact-btn.call:hover { background:var(--green); color:white; }
  .contact-btn.queue { background:rgba(108,92,231,0.1); color:var(--accent2); }
  .contact-btn.queue:hover { background:var(--accent); color:white; }
  .contact-btn.del { background:transparent; color:var(--gray2); }
  .contact-btn.del:hover { background:var(--red-dim); color:var(--red); }
  .queue-list { display: flex; flex-direction: column; gap: 8px; }
  .queue-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: 12px; transition: all 0.3s; }
  .queue-item.calling { border-color: rgba(108,92,231,0.4); background: rgba(108,92,231,0.06); }
  .queue-item.done { border-color: rgba(0,184,148,0.2); background: var(--green-dim); opacity: 0.6; }
  .queue-item.failed { border-color: rgba(225,112,85,0.2); background: var(--red-dim); opacity: 0.6; }
  .item-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--gray2); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
  .item-info { flex: 1; min-width: 0; }
  .item-name { font-size: 13px; font-weight: 600; margin-bottom: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .item-number { font-size: 12px; color: var(--gray); letter-spacing: 0.5px; }
  .item-status { font-size: 11px; font-weight: 600; padding: 3px 10px; border-radius: 20px; flex-shrink: 0; }
  .status-pending { background: var(--yellow-dim); color: var(--yellow); }
  .status-calling { background: rgba(108,92,231,0.15); color: var(--accent2); animation: pulse-text 1.5s infinite; }
  .status-done { background: var(--green-dim); color: var(--green); }
  .status-failed { background: var(--red-dim); color: var(--red); }
  @keyframes pulse-text { 0%,100%{opacity:1} 50%{opacity:0.5} }
  .item-actions { display: flex; gap: 6px; flex-shrink: 0; }
  .btn-icon { width: 30px; height: 30px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--gray); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; transition: all 0.2s; }
  .btn-icon:hover { border-color: var(--accent); color: var(--accent2); }
  .btn-icon.danger:hover { border-color: var(--red); color: var(--red); }
  .btn-icon:disabled { opacity: 0.3; cursor: not-allowed; }

  /* LOG */
  .log-list { display: flex; flex-direction: column; gap: 6px; margin-top: 12px; }
  .log-item { font-size: 12px; color: var(--gray); padding: 8px 12px; background: rgba(255,255,255,0.02); border-radius: 8px; display: flex; align-items: center; gap: 8px; }
  .log-item .dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
  .log-item .log-time { color: var(--gray2); font-size: 11px; margin-left: auto; flex-shrink: 0; }
  .log-empty { color: var(--gray); font-size: 13px; text-align: center; padding: 16px 0; }

  /* Call score badges */
  .score-badge { font-size: 11px; font-weight: 700; padding: 3px 10px; border-radius: 20px; flex-shrink: 0; }
  .score-hot  { background: rgba(255,87,51,0.12); color: #e84c1e; }
  .score-warm { background: rgba(217,119,6,0.12); color: #d97706; }
  .score-cold { background: rgba(107,114,128,0.1); color: #6b7280; }

  /* CRM */
  .crm-item { border: 1px solid var(--border); border-radius: 14px; padding: 14px; background: var(--surface); }
  .crm-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .crm-avatar { width: 36px; height: 36px; border-radius: 50%; background: rgba(108,92,231,0.12); display: flex; align-items: center; justify-content: center; font-size: 15px; font-weight: 700; color: var(--accent2); flex-shrink: 0; }
  .crm-info { flex: 1; }
  .crm-name { font-size: 14px; font-weight: 600; }
  .crm-meta { font-size: 11px; color: var(--gray); margin-top: 2px; }
  .crm-summary { font-size: 12px; color: var(--gray); background: rgba(108,92,231,0.05); border-radius: 8px; padding: 8px 10px; margin-bottom: 10px; line-height: 1.5; }
  .crm-audio { width: 100%; height: 32px; border-radius: 8px; margin-bottom: 8px; }
  .crm-notes { width: 100%; border: 1px solid var(--border); border-radius: 8px; padding: 8px 10px; font-size: 12px; font-family: inherit; color: var(--white); background: var(--surface); resize: none; outline: none; }
  .crm-notes:focus { border-color: var(--accent); }
  .crm-actions { display: flex; gap: 8px; margin-top: 8px; }
  .crm-btn { font-size: 11px; padding: 5px 12px; border-radius: 8px; border: 1px solid var(--border); background: transparent; cursor: pointer; font-family: inherit; font-weight: 600; color: var(--gray); transition: all 0.15s; }
  .crm-btn:hover { background: var(--red-dim); color: var(--red); border-color: var(--red); }

  /* Recent Calls */
  .call-item { display: flex; flex-direction: column; gap: 6px; padding: 12px 0; border-bottom: 1px solid var(--border); }
  .call-item:last-child { border-bottom: none; }
  .call-row { display: flex; align-items: center; gap: 10px; }
  .call-status { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 10px; flex-shrink: 0; }
  .call-status.ended { background: var(--green-dim); color: var(--green); }
  .call-status.failed { background: var(--red-dim); color: var(--red); }
  .call-status.other { background: var(--yellow-dim); color: var(--yellow); }
  .call-number { font-size: 13px; font-weight: 500; flex: 1; }
  .call-duration { font-size: 11px; color: var(--gray); flex-shrink: 0; }
  .call-time { font-size: 11px; color: var(--gray2); }
  .call-audio { width: 100%; height: 32px; border-radius: 8px; outline: none; margin-top: 4px; }
  .call-transcript-btn { font-size: 11px; color: var(--accent2); cursor: pointer; background: none; border: none; font-family: inherit; padding: 0; }
  .call-transcript { font-size: 12px; border-radius: 10px; border: 1px solid var(--border); margin-top: 6px; max-height: 400px; overflow-y: auto; display: none; }
  .ct-summary { padding: 10px 12px; background: rgba(108,92,231,0.06); border-bottom: 1px solid var(--border); }
  .ct-summary strong { font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px; color: var(--accent2); }
  .ct-summary p { margin: 6px 0 0; color: var(--gray); line-height: 1.5; }
  .ct-convo { padding: 10px 12px; display: flex; flex-direction: column; gap: 8px; }
  .ct-line { display: flex; flex-direction: column; gap: 2px; max-width: 85%; }
  .ct-line.ai { align-self: flex-start; }
  .ct-line.user { align-self: flex-end; }
  .ct-speaker { font-size: 10px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }
  .ct-line.ai .ct-speaker { color: var(--accent2); }
  .ct-line.user .ct-speaker { color: var(--green); text-align: right; }
  .ct-bubble { padding: 7px 11px; border-radius: 12px; font-size: 12px; line-height: 1.5; }
  .ct-line.ai .ct-bubble { background: rgba(108,92,231,0.1); color: var(--white); border-bottom-left-radius: 3px; }
  .ct-line.user .ct-bubble { background: var(--green-dim); color: var(--white); border-bottom-right-radius: 3px; }

  /* TOAST */
  .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(100px); padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 500; transition: transform 0.3s; z-index: 100; white-space: nowrap; }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.success { background: var(--green-dim); border: 1px solid rgba(0,184,148,0.3); color: var(--green); }
  .toast.error { background: var(--red-dim); border: 1px solid rgba(225,112,85,0.3); color: var(--red); }
  .toast.info { background: rgba(108,92,231,0.12); border: 1px solid rgba(108,92,231,0.3); color: var(--accent2); }

  @media (max-width: 480px) {
    body { padding: 20px 14px 60px; }
    .hero { flex-direction: column; text-align: center; align-items: center; }
    .sofia-tags { justify-content: center; }
    .phone-row { flex-direction: column; }
    .btn-row { flex-direction: column; }
    .btn-call-now, .btn-add { flex: none; }
    .header { flex-direction: column; gap: 12px; align-items: flex-start; }
  }

/* ‚îÄ‚îÄ BEHAVIOUR TOGGLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.toggle-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 7px 0; border-bottom: 1px solid #111120;
}
.toggle-row:last-child { border: none; }
.toggle-label { font-size: 11px; color: #6b7280; line-height: 1.3; }
.toggle-label span { display: block; font-size: 9px; color: #9ca3af; margin-top: 1px; }
.toggle-switch {
  width: 34px; height: 18px; border-radius: 18px;
  background: #222; position: relative; cursor: pointer;
  flex-shrink: 0; transition: background 0.2s; margin-left: 8px;
}
.toggle-switch.on { background: #7c3aed; }
.toggle-switch::after {
  content: ''; width: 13px; height: 13px; border-radius: 50%;
  background: white; position: absolute; top: 2.5px; left: 2.5px;
  transition: left 0.2s;
}
.toggle-switch.on::after { left: 18px; }


/* ‚îÄ‚îÄ SPLIT PANEL B ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.split-layout { display: flex; min-height: 100vh; }

.sb { width: 230px; flex-shrink: 0; background: #f5f5fa; border-right: 1px solid #e8e8f0;
  display: flex; flex-direction: column; padding: 16px 12px; gap: 0;
  position: sticky; top: 0; height: 100vh; overflow-y: auto; }

.sb-label { font-size: 9px; font-weight: 700; color: #6b7280; text-transform: uppercase;
  letter-spacing: 1.2px; margin: 14px 0 7px; }
.sb-label:first-child { margin-top: 0; }
.sb-hr { border: none; border-top: 1px solid #111120; margin: 10px 0; }

/* Sidebar agent cards */
.sb-agent { display: flex; align-items: center; gap: 9px; padding: 9px 10px;
  border-radius: 10px; border: 1px solid transparent; cursor: pointer;
  transition: all 0.15s; margin-bottom: 5px; }
.sb-agent:hover { background: #f5f5fa; border-color: #1e1e35; }
.sb-agent.active { background: #ede9ff; border-color: #7c3aed; }
.sb-agent .sa-emoji { font-size: 18px; flex-shrink: 0; }
.sb-agent .sa-name { font-size: 12px; font-weight: 600; }
.sb-agent .sa-sub  { font-size: 10px; color: #9ca3af; margin-top: 1px; }
.sb-new { display: flex; align-items: center; justify-content: center;
  padding: 7px; border-radius: 10px; border: 1.5px dashed #ddddf5;
  color: #c7c7e8; font-size: 12px; cursor: pointer; margin-bottom: 5px; transition: all 0.15s; }
.sb-new:hover { border-color: #7c3aed; color: #7c3aed; background: rgba(124,58,237,0.05); }

/* New Agent Modal */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 200; display: none; align-items: center; justify-content: center; padding: 20px; }
.modal-overlay.open { display: flex; }
.modal { background: #fff; border-radius: 18px; padding: 28px 24px; width: 100%; max-width: 480px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.15); }
.modal-title { font-size: 17px; font-weight: 700; margin-bottom: 20px; }
.modal-field { margin-bottom: 16px; }
.modal-field label { display: block; font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 6px; }
.modal-field input, .modal-field textarea { width: 100%; border: 1px solid #e5e7eb; border-radius: 10px; padding: 9px 12px; font-size: 13px; font-family: inherit; color: #1a1a2e; outline: none; transition: border 0.15s; resize: vertical; }
.modal-field input:focus, .modal-field textarea:focus { border-color: #7c3aed; }
.modal-emoji-row { display: flex; gap: 8px; align-items: center; }
.modal-emoji-row input { width: 60px; text-align: center; font-size: 20px; flex-shrink: 0; }
.modal-actions { display: flex; gap: 10px; margin-top: 24px; }
.modal-btn { flex: 1; padding: 11px; border-radius: 12px; border: none; font-size: 14px; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.modal-btn.primary { background: #7c3aed; color: white; }
.modal-btn.primary:hover { background: #6d28d9; }
.modal-btn.secondary { background: #f3f4f6; color: #6b7280; }
.modal-btn.secondary:hover { background: #e5e7eb; }
.modal-tabs { display: flex; gap: 6px; margin-bottom: 16px; }
.modal-tab { flex: 1; padding: 7px; border-radius: 8px; border: 1px solid #e5e7eb; background: none; font-size: 12px; font-weight: 600; cursor: pointer; font-family: inherit; color: #6b7280; transition: all 0.15s; }
.modal-tab.active { background: #7c3aed; color: white; border-color: #7c3aed; }
.sb-agent-del { margin-left: auto; font-size: 12px; color: #d1d5db; cursor: pointer; padding: 2px 4px; border-radius: 4px; display: none; }
.sb-agent:hover .sb-agent-del { display: block; }
.sb-agent-del:hover { color: #e17055; background: rgba(225,112,85,0.1); }

/* Knowledge files */
.kf-item { display: flex; align-items: center; gap: 8px; background: #f8f8fc;
  border: 1px solid #eeeeF5; border-radius: 8px; padding: 7px 9px; margin-bottom: 5px; }
.kf-icon { font-size: 14px; flex-shrink: 0; }
.kf-name { font-size: 11px; font-weight: 600; white-space: nowrap; overflow: hidden;
  text-overflow: ellipsis; max-width: 110px; }
.kf-size { font-size: 9px; color: #6b7280; }
.kf-del { margin-left: auto; color: #c7c7e8; cursor: pointer; font-size: 13px; flex-shrink: 0; }
.kf-del:hover { color: #cc2244; }
.kf-empty { font-size: 10px; color: #c7c7e8; text-align: center; padding: 4px 0 8px; }

.upload-btn { display: flex; align-items: center; justify-content: center; gap: 6px;
  border: 1.5px dashed #ddd8ff; border-radius: 9px; padding: 10px;
  color: #6b7280; font-size: 11px; cursor: pointer; transition: all 0.15s; margin-top: 2px; }
.upload-btn:hover { border-color: #7c3aed; color: #6b7280; }

/* Behaviour toggles */
.tog-row { display: flex; align-items: center; justify-content: space-between;
  padding: 7px 2px; border-bottom: 1px solid #0f0f1e; }
.tog-row:last-child { border: none; }
.tog-label { font-size: 10px; color: #6b7280; line-height: 1.3; }
.tog-label small { display: block; font-size: 9px; color: #6b7280; margin-top: 1px; }
.tog { width: 30px; height: 16px; border-radius: 16px; background: #f0f0f8;
  position: relative; cursor: pointer; flex-shrink: 0; transition: background 0.2s; margin-left: 6px; }
.tog.on { background: #7c3aed; }
.tog::after { content: ''; width: 12px; height: 12px; border-radius: 50%; background: #555;
  position: absolute; top: 2px; left: 2px; transition: left 0.15s, background 0.15s; }
.tog.on::after { left: 16px; background: white; }

/* Main panel */
.mp { flex: 1; min-width: 0; padding: 20px 18px; max-width: 620px; }

/* Preset cards */
.preset-grid { display: flex; flex-direction: column; gap: 5px; margin-bottom: 14px; }
.preset-card { display: flex; align-items: center; gap: 9px; background: #f8f8fc;
  border: 1px solid #eeeeF5; border-radius: 9px; padding: 9px 11px; cursor: pointer; transition: all 0.15s; }
.preset-card:hover { border-color: #2a1a5a; }
.preset-card.active { border-color: #7c3aed; background: #f0ebff; }
.preset-dot { width: 6px; height: 6px; border-radius: 50%; background: #222; flex-shrink: 0; }
.preset-card.active .preset-dot { background: #7c3aed; }
.preset-card .pc-name { font-size: 11px; font-weight: 600; }
.preset-card .pc-prev { font-size: 10px; color: #9ca3af; margin-top: 1px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 260px; }

/* Agent header in main panel */
.mp-header { display: flex; align-items: center; gap: 10px; margin-bottom: 18px;
  padding-bottom: 14px; border-bottom: 1px solid #e8e8f0; }
.mp-emoji { font-size: 26px; }
.mp-name  { font-size: 17px; font-weight: 700; }
.mp-sub   { font-size: 11px; color: #9ca3af; margin-top: 2px; }

/* Mobile */
@media (max-width: 680px) {
  .split-layout { flex-direction: column; }
  .sb { width: 100%; height: auto; position: static; flex-direction: column;
    padding: 12px; border-right: none; border-bottom: 1px solid #15152a; }
  .sb-agents-row { display: flex; flex-direction: row; gap: 8px; overflow-x: auto; padding-bottom: 4px; }
  .sb-agents-row .sb-agent { flex-shrink: 0; width: auto; }
  .mp { padding: 14px; }
}


/* ‚îÄ‚îÄ SIMULATION MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#sim-modal { display:none; position:fixed; inset:0; z-index:400; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; }
#sim-modal.open { display:flex; }
.sim-box { background:#1a1a2e; border:1px solid #2a1a5a; border-radius:16px; width:min(640px,96vw); max-height:88vh; overflow:hidden; display:flex; flex-direction:column; box-shadow:0 24px 80px rgba(0,0,0,0.6); }
.sim-header { display:flex; align-items:center; justify-content:space-between; padding:18px 22px 14px; border-bottom:1px solid #2a1a5a; }
.sim-header h3 { margin:0; font-size:15px; color:#e2e0ff; }
.sim-header .sim-close { background:none; border:none; color:#888; font-size:20px; cursor:pointer; padding:0 4px; }
.sim-header .sim-close:hover { color:#fff; }
.sim-body { padding:20px 22px; overflow-y:auto; flex:1; }
.sim-section-label { font-size:11px; font-weight:700; color:#7c3aed; letter-spacing:.06em; text-transform:uppercase; margin-bottom:10px; }
.scenario-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px; }
.scenario-card { background:#0f0f20; border:1.5px solid #2a2a4a; border-radius:10px; padding:12px 14px; cursor:pointer; transition:border-color .2s,background .2s; }
.scenario-card:hover { border-color:#7c3aed; }
.scenario-card.active { border-color:#7c3aed; background:#1e0a40; }
.scenario-card .sc-emoji { font-size:20px; margin-bottom:6px; }
.scenario-card .sc-name { font-size:12px; font-weight:700; color:#e2e0ff; margin-bottom:3px; }
.scenario-card .sc-hint { font-size:11px; color:#9ca3af; line-height:1.4; }
.sim-tip { background:#0d1a2a; border:1px solid #1a3a5a; border-radius:8px; padding:11px 14px; font-size:12px; color:#7eb8e8; margin-bottom:18px; line-height:1.5; }
.sim-tip strong { color:#a3d4f7; }
.sim-start-btn { width:100%; padding:13px; background:linear-gradient(135deg,#7c3aed,#5b21b6); color:#fff; border:none; border-radius:10px; font-size:14px; font-weight:700; cursor:pointer; transition:opacity .2s; margin-bottom:16px; }
.sim-start-btn:hover { opacity:.88; }
.sim-start-btn:disabled { opacity:.45; cursor:not-allowed; }
.sim-live-transcript { background:#0a0a18; border:1px solid #2a1a5a; border-radius:10px; padding:12px 14px; min-height:80px; max-height:220px; overflow-y:auto; margin-bottom:16px; display:none; }
.sim-live-transcript.visible { display:block; }
.sim-tx-line { font-size:12px; line-height:1.6; margin-bottom:4px; }
.sim-tx-line.ai { color:#c4b5fd; }
.sim-tx-line.user { color:#6ee7b7; }
.sim-tx-label { font-size:10px; font-weight:700; margin-right:5px; opacity:.7; }
.sim-score-card { background:#0a0a18; border:1px solid #2a1a5a; border-radius:10px; padding:16px 18px; display:none; }
.sim-score-card.visible { display:block; }
.sim-score-title { font-size:13px; font-weight:700; color:#e2e0ff; margin-bottom:12px; }
.sim-score-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; font-size:12px; color:#ccc; }
.sim-score-row .si { font-size:15px; width:20px; text-align:center; }
.sim-score-overall { display:flex; align-items:center; gap:10px; margin-top:14px; padding-top:12px; border-top:1px solid #2a1a5a; font-size:14px; font-weight:700; color:#e2e0ff; }
.sim-score-bar { flex:1; height:8px; background:#2a1a5a; border-radius:4px; overflow:hidden; }
.sim-score-fill { height:100%; border-radius:4px; transition:width .6s; }
.sim-reset-btn { margin-top:14px; width:100%; padding:10px; background:transparent; border:1px solid #3a2a6a; color:#c4b5fd; border-radius:8px; font-size:13px; cursor:pointer; }
.sim-reset-btn:hover { background:#1e0a40; }
.btn-simulate { display:inline-flex; align-items:center; gap:6px; padding:8px 16px; background:rgba(124,58,237,0.15); border:1.5px solid rgba(124,58,237,0.4); color:#c4b5fd; border-radius:8px; font-size:12px; font-weight:600; cursor:pointer; transition:all .2s; margin-left:8px; }
.btn-simulate:hover { background:rgba(124,58,237,0.3); border-color:#7c3aed; }
@media (max-width:480px) { .scenario-grid { grid-template-columns:1fr; } }
</style>
</head>
<body>

<div class="split-layout">

<!-- ‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê -->
<div class="sb" id="sb">

  <img id="sb-logo-img" src="" alt="logo">
  <div class="sb-label" id="sb-company-label">Agents</div>
  <div id="sb-agents-wrap">
    <div class="sb-agent active" id="sb-sofia" onclick="setAgent('sofia')">
      <span class="sa-emoji">üë©‚Äçüíº</span>
      <div><div class="sa-name">Maria</div><div class="sa-sub">Growth-onomics</div></div>
    </div>
    <div class="sb-agent" id="sb-sofia2" onclick="setAgent('sofia2')">
      <span class="sa-emoji">ü§ñ</span>
      <div><div class="sa-name">Elena</div><div class="sa-sub">AI Marketing</div></div>
    </div>
    <div class="sb-agent" id="sb-sofia3" onclick="setAgent('sofia3')">
      <span class="sa-emoji">üëó</span>
      <div><div class="sa-name">Sofia 3</div><div class="sa-sub">ŒúŒôŒë Collection</div></div>
    </div>
    <div class="sb-new" onclick="openAgentModal()">Ôºã New Agent</div>
  </div>

  <div class="sb-hr"></div>
  <div class="sb-label">üìÅ Knowledge Files</div>
  <div id="kf-list"><div class="kf-empty">No files yet</div></div>
  <div class="upload-btn" onclick="document.getElementById('kf-input').click()">
    üìé &nbsp;Add file (PDF ¬∑ TXT ¬∑ DOCX)
  </div>
  <input type="file" id="kf-input" accept=".pdf,.txt,.docx" multiple style="display:none" onchange="handleFileUpload(event)">

  <div class="sb-hr"></div>
  <div class="sb-label">üéõ Behaviour</div>

  <div class="tog-row">
    <div class="tog-label">Backchanneling<small>"yeah", "uh-huh"</small></div>
    <div class="tog on" id="tog-backchannel" onclick="toggleB('backchannel',this)"></div>
  </div>
  <div class="tog-row">
    <div class="tog-label">Response delay<small>Pause before speaking</small></div>
    <div class="tog on" id="tog-delay" onclick="toggleB('delay',this)"></div>
  </div>
  <div class="tog-row">
    <div class="tog-label">Never reveal AI<small>Deny being a bot</small></div>
    <div class="tog on" id="tog-noai" onclick="toggleB('noai',this)"></div>
  </div>
  <div class="tog-row">
    <div class="tog-label">Auto-book call<small>Push for 20-min video</small></div>
    <div class="tog" id="tog-autobook" onclick="toggleB('autobook',this)"></div>
  </div>

  <div class="sb-hr"></div>
  <div style="padding:8px 0 4px">
    <button id="btn-settings" onclick="openSettings()" style="width:100%;background:none;border:1px solid var(--border);border-radius:10px;padding:8px 12px;color:var(--gray);font-size:13px;font-family:inherit;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent2)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--gray)'">‚öôÔ∏è &nbsp;Settings</button>
  </div>

</div><!-- /sb -->

<!-- ‚ïê‚ïê‚ïê‚ïê MAIN PANEL ‚ïê‚ïê‚ïê‚ïê -->
<div class="mp">

  <!-- Agent header -->
  <div class="mp-header" id="mp-header" style="display:none">
    <span class="mp-emoji">üë©‚Äçüíº</span>
    <div><div class="mp-name">Maria</div><div class="mp-sub">Growth-onomics</div></div>
  </div>

  <!-- Old page content starts here -->
  <div class="page" style="padding:0;background:none;max-width:none">

  <!-- HEADER -->
  <div class="header" style="display:none">
    <div class="brand">Growth<span>-onomics</span></div>
    <div class="badge">Sofia Online</div>
  </div>

  <!-- HERO -->
  <div class="hero" style="display:none">
    <div class="sofia-avatar-sm">üë©‚Äçüíº</div>
    <div class="sofia-info">
      <div class="sofia-name">Maria</div>
      <div class="sofia-title">AI BizDev Agent ¬∑ <span>Growth-onomics</span></div>
      <div class="sofia-tags">
        <span class="tag">Fintech Outreach</span>
        <span class="tag">Paid Acquisition</span>
        <span class="tag">GEO Pitch</span>
        <span class="tag">Books Strategy Calls</span>
      </div>
    </div>
  </div>

  <!-- AGENT SELECTOR -->
  <div class="agent-selector" style="display:none">
    <div class="agent-card active" id="agent-card-sofia" onclick="setAgent('sofia')">
      <div class="agent-card-header">
        <span class="agent-emoji">üë©‚Äçüíº</span>
        <span class="agent-card-name" contenteditable="false" data-agent="sofia">Maria</span>
        <div class="agent-active-dot"></div>
      </div>
      <div class="agent-card-desc" contenteditable="false" data-agent="sofia">Fintech BizDev ¬∑ Paid Acquisition, GEO, B2B Demand Gen</div>
      <div class="edit-controls">
        <button class="btn-edit-save" onclick="saveAgentEdit('sofia')">‚úì Save</button>
        <button class="btn-edit-cancel" onclick="cancelAgentEdit('sofia')">‚úï Cancel</button>
      </div>
    </div>
    <div class="agent-card" id="agent-card-sofia2" onclick="setAgent('sofia2')">
      <div class="agent-card-header">
        <span class="agent-emoji">ü§ñ</span>
        <span class="agent-card-name" contenteditable="false" data-agent="sofia2">Elena</span>
        <div class="agent-active-dot"></div>
      </div>
      <div class="agent-card-desc" contenteditable="false" data-agent="sofia2">AI Marketing ¬∑ Sells AI optimization to any industry</div>
      <div class="edit-controls">
        <button class="btn-edit-save" onclick="saveAgentEdit('sofia2')">‚úì Save</button>
        <button class="btn-edit-cancel" onclick="cancelAgentEdit('sofia2')">‚úï Cancel</button>
      </div>
    </div>
    <div class="agent-card" id="agent-card-sofia3" onclick="setAgent('sofia3')">
      <div class="agent-card-header">
        <span class="agent-emoji">üëó</span>
        <span class="agent-card-name" contenteditable="false" data-agent="sofia3">Sofia 3</span>
        <div class="agent-active-dot"></div>
      </div>
      <div class="agent-card-desc" contenteditable="false" data-agent="sofia3">Fashion Wholesale ¬∑ Sells ŒúŒôŒë Collection to boutiques</div>
      <div class="edit-controls">
        <button class="btn-edit-save" onclick="saveAgentEdit('sofia3')">‚úì Save</button>
        <button class="btn-edit-cancel" onclick="cancelAgentEdit('sofia3')">‚úï Cancel</button>
      </div>
    </div>
  </div>

  <!-- MODE TABS -->
  <div class="mode-tabs">
    <button class="mode-tab active" id="tab-browser" onclick="setMode('browser')">üéôÔ∏è &nbsp;Browser Call</button>
    <button class="mode-tab" id="tab-phone" onclick="setMode('phone')">üìû &nbsp;Phone Call</button>
  </div>

  <!-- LANGUAGE TOGGLE -->
  <div class="lang-toggle">
    <button class="lang-btn active" id="lang-en" onclick="setLang('en')">üá∫üá∏ &nbsp;English</button>
    <button class="lang-btn" id="lang-el" onclick="setLang('el')">üá¨üá∑ &nbsp;ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- BROWSER CALL SECTION                        -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="browser-section active" id="browser-section">

    <div class="browser-card">
      <div class="avatar-wrap">
        <div class="avatar-lg" id="avatar">üë©‚Äçüíº</div>
        <div class="online-dot" id="dot"></div>
      </div>

      <div class="wave-wrap" id="wave">
        <div class="wave-bar idle" id="wb1"></div>
        <div class="wave-bar idle" id="wb2"></div>
        <div class="wave-bar idle" id="wb3"></div>
        <div class="wave-bar idle" id="wb4"></div>
        <div class="wave-bar idle" id="wb5"></div>
        <div class="wave-bar idle" id="wb6"></div>
        <div class="wave-bar idle" id="wb7"></div>
      </div>

      <div class="call-timer" id="call-timer">00:00</div>
      <div class="call-status" id="call-status">Available now</div>

      <button class="btn-talk" id="btn-talk" onclick="startBrowserCall()">üéôÔ∏è &nbsp;Talk to Maria</button>
      <button class="btn-end-call" id="btn-end-call" onclick="endBrowserCall()">üìµ &nbsp;End Call</button>
      <button class="btn-simulate" onclick="openSimModal()">üß™ &nbsp;Simulate</button>
    </div>

  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- PHONE CALL SECTION                          -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="phone-section" id="phone-section">

    <!-- OPENER PREVIEW -->
    <div class="opener-preview" id="opener-preview-box">
      <div class="opener-label">üìû Sofia's opener</div>
      <div id="opener-preview-text"></div>
    </div>

    <!-- CUSTOMIZE TOGGLE -->
    <button class="customize-toggle" id="customize-toggle" onclick="toggleCustomize()">
      <div class="toggle-left">
        ‚úèÔ∏è &nbsp;Customize Agent
        <span class="modified-badge" id="modified-badge">Modified</span>
      </div>
      <span class="toggle-arrow" id="toggle-arrow">‚ñº</span>
    </button>

    <div class="customize-body" id="customize-body">
      <div class="field-label">Opening Line <span class="field-hint">First thing Sofia says when they pick up</span></div>
      <textarea class="custom-textarea" id="custom-opener" rows="3" placeholder="Sofia's first message..."></textarea>
      <hr class="field-sep">
      <div class="field-label">System Prompt <span class="field-hint">Sofia's full instructions & personality</span></div>
      <textarea class="custom-textarea system-prompt" id="custom-system" placeholder="Sofia's system prompt..."></textarea>
      <div class="reset-row">
        <button class="btn-reset" onclick="resetDefaults()">‚Ü∫ Reset to Default</button>
        <button class="btn-save-prompt" onclick="savePrompt()">‚úì Save Changes</button>
      </div>
    </div>

    <!-- DIALER -->
    <div class="card" style="margin-top:20px">
      <div class="card-title">üì≤ Call a Number</div>
      <input type="text" class="name-input" id="contact-name" placeholder="Contact name (optional)" />
      <div class="phone-row">
        <select class="country-select" id="country-code">
          <option value="+30">üá¨üá∑ +30</option>
          <option value="+1">üá∫üá∏ +1</option>
          <option value="+44">üá¨üáß +44</option>
          <option value="+49">üá©üá™ +49</option>
          <option value="+33">üá´üá∑ +33</option>
          <option value="+31">üá≥üá± +31</option>
          <option value="+34">üá™üá∏ +34</option>
          <option value="+39">üáÆüáπ +39</option>
          <option value="+61">üá¶üá∫ +61</option>
          <option value="+971">üá¶üá™ +971</option>
        </select>
        <input type="tel" class="phone-input" id="phone-number" placeholder="Phone number" />
      </div>
      <div class="btn-row">
        <button class="btn-add" onclick="addToQueue()">+ Add to List</button>
        <button class="btn-call-now" id="btn-call-now" onclick="callNow()">üìû Call Now with Sofia</button>
      </div>
    </div>

    <!-- QUEUE -->
    <div class="card">
      <div class="queue-header">
        <div class="card-title" style="margin:0">üìã Call List <span class="queue-count" id="queue-count">0</span></div>
        <button class="btn-call-all" id="btn-call-all" onclick="callAll()" disabled>‚ñ∂ Call All</button>
      </div>
      <div id="queue-empty" class="queue-empty">Add numbers above to build your call list</div>
      <div class="queue-list" id="queue-list"></div>
    </div>

  <!-- CONTACT BOOK -->
  <div class="card" style="margin-top:16px">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
      <div class="card-title" style="margin:0">üìí Contact Book</div>
      <div style="display:flex;gap:8px">
        <button onclick="document.getElementById('csv-import').click()" style="font-size:11px;padding:4px 10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--gray);cursor:pointer;font-family:inherit">‚¨Ü Import CSV</button>
        <button onclick="queueAllContacts()" style="font-size:11px;padding:4px 10px;border-radius:8px;border:1px solid var(--accent);background:transparent;color:var(--accent2);cursor:pointer;font-family:inherit">+ Queue All</button>
      </div>
    </div>
    <input type="file" id="csv-import" accept=".csv" style="display:none" onchange="importCSV(event)">
    <!-- Campaign filter -->
    <div style="margin-bottom:10px">
      <select id="cb-campaign-filter" onchange="renderContacts()" style="width:100%;border:1px solid var(--border);border-radius:10px;padding:7px 12px;font-size:12px;font-family:inherit;outline:none;color:var(--gray);background:var(--surface);cursor:pointer">
        <option value="">All campaigns</option>
      </select>
    </div>
    <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
      <input type="text" id="cb-name" placeholder="Name" style="flex:1;min-width:90px;border:1px solid var(--border);border-radius:10px;padding:8px 12px;font-size:13px;font-family:inherit;outline:none;color:var(--white);background:var(--surface)">
      <input type="tel" id="cb-number" placeholder="+30..." style="flex:1;min-width:90px;border:1px solid var(--border);border-radius:10px;padding:8px 12px;font-size:13px;font-family:inherit;outline:none;color:var(--white);background:var(--surface)">
    </div>
    <div style="display:flex;gap:8px;margin-bottom:12px">
      <input type="text" id="cb-campaign" placeholder="Campaign (optional)" style="flex:1;border:1px solid var(--border);border-radius:10px;padding:8px 12px;font-size:13px;font-family:inherit;outline:none;color:var(--white);background:var(--surface)">
      <button onclick="addContact()" style="padding:8px 14px;border-radius:10px;background:var(--accent);border:none;color:white;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;flex-shrink:0">+ Add</button>
    </div>
    <div id="contact-book-empty" class="queue-empty" style="padding:16px 0">No contacts yet ‚Äî add one above or import a CSV</div>
    <div id="contact-book-list" style="display:flex;flex-direction:column;gap:6px"></div>
  </div>

  </div><!-- /phone-section -->

  <!-- LOG (shared) -->
  <div class="card">
    <div class="card-title">üóíÔ∏è Activity Log</div>
    <div id="log-list" class="log-list">
      <div class="log-empty" id="log-empty">No calls made yet</div>
    </div>
  </div>

  <!-- RECENT CALLS -->
  <div class="card" id="recent-calls-card">
    <div class="card-title" style="display:flex;align-items:center;justify-content:space-between">
      <span>üìû Recent Calls ‚Äî <span id="calls-agent-label" style="color:var(--accent2)">All</span></span>
      <button onclick="loadRecentCalls()" id="calls-refresh-btn" style="font-size:11px;padding:4px 12px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--accent2);cursor:pointer;font-family:inherit">‚Üª Refresh</button>
    </div>
    <div id="calls-list"><div class="log-empty">Press Refresh to load calls</div></div>
  </div>

  <!-- CRM -->
  <div class="card" id="crm-card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
      <div class="card-title" style="margin:0">üèÜ CRM ‚Äî Hot Leads</div>
      <button onclick="exportCRM()" style="font-size:11px;padding:4px 12px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--accent2);cursor:pointer;font-family:inherit">‚¨á Export CSV</button>
    </div>
    <div id="crm-empty" class="log-empty">No leads yet ‚Äî positive calls get added here</div>
    <div id="crm-list" style="display:flex;flex-direction:column;gap:10px"></div>
  </div>

  </div><!-- /inner-page -->
</div><!-- /mp -->
</div><!-- /split-layout -->

<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê CALL OUTCOME MODAL ‚ïê‚ïê‚ïê‚ïê -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIMULATION MODAL ‚ïê‚ïê -->
<div id="sim-modal">
  <div class="sim-box">
    <div class="sim-header">
      <h3>üß™ Agent Simulation Test</h3>
      <button class="sim-close" onclick="closeSimModal()">‚úï</button>
    </div>
    <div class="sim-body">

      <div class="sim-section-label">1. Pick a customer scenario</div>
      <div class="scenario-grid" id="scenario-grid">
        <div class="scenario-card active" data-idx="0" onclick="selectScenario(0)">
          <div class="sc-emoji">üòä</div>
          <div class="sc-name">Interested Buyer</div>
          <div class="sc-hint">Curious, open to listening. Asks what you sell and how it works.</div>
        </div>
        <div class="scenario-card" data-idx="1" onclick="selectScenario(1)">
          <div class="sc-emoji">ü§î</div>
          <div class="sc-name">The Objector</div>
          <div class="sc-hint">Skeptical. Says "I'm not sure" and "I need to think about it."</div>
        </div>
        <div class="scenario-card" data-idx="2" onclick="selectScenario(2)">
          <div class="sc-emoji">üí∂</div>
          <div class="sc-name">Price Shopper</div>
          <div class="sc-hint">Asks "how much?" immediately. Compares with competitors.</div>
        </div>
        <div class="scenario-card" data-idx="3" onclick="selectScenario(3)">
          <div class="sc-emoji">üìµ</div>
          <div class="sc-name">Wrong Number / Hostile</div>
          <div class="sc-hint">Annoyed from the start. Tests graceful recovery and politeness.</div>
        </div>
      </div>

      <div class="sim-tip" id="sim-scenario-tip">
        <strong>Scenario:</strong> A curious potential customer who received a cold call ‚Äî open and friendly, asks what the brand sells.
      </div>

      <div class="sim-section-label" style="display:flex;align-items:center;justify-content:space-between;">
        <span>2. Run the simulation ‚Äî no mic needed</span>
        <button id="sim-mute-btn" onclick="toggleSimMute()" style="background:rgba(124,58,237,0.15);border:1px solid rgba(124,58,237,0.35);color:#c4b5fd;border-radius:6px;padding:3px 10px;font-size:11px;cursor:pointer;">üîä Sound ON</button>
      </div>
      <button class="sim-start-btn" id="sim-start-btn" onclick="startSimCall()">‚ñ∂ Run Auto-Simulation</button>

      <div class="sim-live-transcript" id="sim-transcript">
        <div style="color:#555;font-size:12px;text-align:center;margin-top:16px;">Live transcript will appear here...</div>
      </div>

      <div class="sim-score-card" id="sim-score-card">
        <div class="sim-score-title">üìä Simulation Results</div>
        <div id="sim-score-rows"></div>
        <div class="sim-score-overall">
          <span id="sim-score-grade"></span>
          <div class="sim-score-bar"><div class="sim-score-fill" id="sim-score-fill"></div></div>
          <span id="sim-score-pct"></span>
        </div>
        <button class="sim-reset-btn" onclick="resetSim()">üîÑ Run Another Test</button>
      </div>

    </div>
  </div>
</div>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div id="outcome-modal" style="display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;display:none">
  <div style="background:var(--surface);border-radius:18px;padding:24px 20px;width:300px;box-shadow:0 20px 60px rgba(0,0,0,0.3);border:1px solid var(--border)">
    <div style="font-size:15px;font-weight:700;margin-bottom:6px;color:var(--white)">How did the call go?</div>
    <div style="font-size:12px;color:var(--gray);margin-bottom:18px" id="outcome-contact-label"></div>
    <div style="display:flex;flex-direction:column;gap:10px">
      <button onclick="submitOutcome('booked')" class="outcome-btn" style="background:rgba(5,150,105,0.1);color:#059669;border:1px solid rgba(5,150,105,0.25)">üóìÔ∏è &nbsp;Booked meeting</button>
      <button onclick="submitOutcome('email')" class="outcome-btn" style="background:rgba(108,92,231,0.1);color:var(--accent2);border:1px solid rgba(108,92,231,0.25)">üìß &nbsp;Requested email</button>
      <button onclick="submitOutcome('followup')" class="outcome-btn" style="background:rgba(217,119,6,0.1);color:#d97706;border:1px solid rgba(217,119,6,0.25)">‚ùì &nbsp;Needs follow-up</button>
      <button onclick="submitOutcome('notinterested')" class="outcome-btn" style="background:rgba(225,112,85,0.1);color:var(--red);border:1px solid rgba(225,112,85,0.25)">‚ùå &nbsp;Not interested</button>
    </div>
    <button onclick="closeOutcomeModal()" style="margin-top:14px;width:100%;background:none;border:none;color:var(--gray);font-size:12px;cursor:pointer;font-family:inherit">Skip</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê SETTINGS DRAWER ‚ïê‚ïê‚ïê‚ïê -->
<div id="settings-overlay" onclick="closeSettings()" style="display:none;position:fixed;inset:0;z-index:400;background:rgba(0,0,0,0.35)"></div>
<div id="settings-drawer" style="position:fixed;top:0;right:-340px;width:320px;height:100vh;background:var(--surface);border-left:1px solid var(--border);z-index:401;transition:right 0.3s ease;overflow-y:auto;padding:24px 20px;display:flex;flex-direction:column;gap:0">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
    <div style="font-size:16px;font-weight:700">‚öôÔ∏è Settings</div>
    <button onclick="closeSettings()" style="background:none;border:none;font-size:18px;cursor:pointer;color:var(--gray)">‚úï</button>
  </div>

  <!-- HubSpot -->
  <div class="sdrawer-section">
    <div class="sdrawer-label">üîó HubSpot Webhook</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span style="font-size:12px;color:var(--gray);flex:1">Enable</span>
      <div class="tog" id="tog-hubspot" onclick="toggleSetting('hubspot',this)"></div>
    </div>
    <input type="url" id="s-hubspot-url" placeholder="https://api.hubspot.com/webhooks/..." class="sdrawer-input" oninput="saveSetting('hubspotUrl',this.value)">
  </div>

  <!-- Google Sheets -->
  <div class="sdrawer-section">
    <div class="sdrawer-label">üìä Google Sheets Webhook</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span style="font-size:12px;color:var(--gray);flex:1">Enable</span>
      <div class="tog" id="tog-gsheets" onclick="toggleSetting('gsheets',this)"></div>
    </div>
    <input type="url" id="s-gsheets-url" placeholder="https://script.google.com/macros/..." class="sdrawer-input" oninput="saveSetting('gsheetsUrl',this.value)">
  </div>

  <!-- Email Follow-up -->
  <div class="sdrawer-section">
    <div class="sdrawer-label">üìß Email Follow-up</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span style="font-size:12px;color:var(--gray);flex:1">Enable</span>
      <div class="tog" id="tog-emailfu" onclick="toggleSetting('emailfu',this)"></div>
    </div>
    <textarea id="s-email-template" class="sdrawer-input" rows="4" placeholder="Email template..." oninput="saveSetting('emailTemplate',this.value)" style="resize:vertical"></textarea>
  </div>

  <!-- Scheduled Calling -->
  <div class="sdrawer-section">
    <div class="sdrawer-label">‚è∞ Scheduled Calling</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span style="font-size:12px;color:var(--gray);flex:1">Enable</span>
      <div class="tog" id="tog-schedule" onclick="toggleSetting('schedule',this)"></div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      <span style="font-size:12px;color:var(--gray)">Start time:</span>
      <input type="time" id="s-sched-time" class="sdrawer-input" style="width:120px" oninput="saveSetting('schedTime',this.value)">
    </div>
    <div style="font-size:12px;color:var(--gray);margin-bottom:6px">Days:</div>
    <div style="display:flex;flex-wrap:wrap;gap:6px" id="sched-days">
      <label class="day-check"><input type="checkbox" value="Mon" onchange="saveSchedDays()"> Mon</label>
      <label class="day-check"><input type="checkbox" value="Tue" onchange="saveSchedDays()"> Tue</label>
      <label class="day-check"><input type="checkbox" value="Wed" onchange="saveSchedDays()"> Wed</label>
      <label class="day-check"><input type="checkbox" value="Thu" onchange="saveSchedDays()"> Thu</label>
      <label class="day-check"><input type="checkbox" value="Fri" onchange="saveSchedDays()"> Fri</label>
      <label class="day-check"><input type="checkbox" value="Sat" onchange="saveSchedDays()"> Sat</label>
      <label class="day-check"><input type="checkbox" value="Sun" onchange="saveSchedDays()"> Sun</label>
    </div>
  </div>

  

</div>

<!-- NEW AGENT MODAL -->
<div class="modal-overlay" id="agent-modal" onclick="closeAgentModal(event)">
  <div class="modal">
    <div class="modal-title" id="modal-title">‚ú® New Agent</div>
    <div class="modal-field">
      <label>Emoji &amp; Name</label>
      <div class="modal-emoji-row">
        <input type="text" id="modal-emoji" value="ü§ñ" maxlength="2">
        <input type="text" id="modal-name" placeholder="Agent name" style="flex:1">
      </div>
    </div>
    <div class="modal-field">
      <label>Description</label>
      <input type="text" id="modal-desc" placeholder="e.g. Sales outreach for hotels">
    </div>
    <div class="modal-tabs">
      <button class="modal-tab active" onclick="switchModalLang('en',this)">üá∫üá∏ English</button>
      <button class="modal-tab" onclick="switchModalLang('el',this)">üá¨üá∑ Greek</button>
    </div>
    <div id="modal-lang-en">
      <div class="modal-field">
        <label>Opening line (EN)</label>
        <input type="text" id="modal-opener-en" placeholder="Hi, this is...">
      </div>
      <div class="modal-field">
        <label>System prompt (EN)</label>
        <textarea id="modal-system-en" rows="6" placeholder="You are..."></textarea>
      </div>
    </div>
    <div id="modal-lang-el" style="display:none">
      <div class="modal-field">
        <label>Opening line (EL)</label>
        <input type="text" id="modal-opener-el" placeholder="ŒìŒµŒπŒ±, ŒµŒØŒºŒ±Œπ Œ∑...">
      </div>
      <div class="modal-field">
        <label>System prompt (EL)</label>
        <textarea id="modal-system-el" rows="6" placeholder="ŒïŒØœÉŒ±Œπ..."></textarea>
      </div>
    </div>
    <div class="modal-actions">
      <button class="modal-btn secondary" onclick="closeAgentModal()">Cancel</button>
      <button class="modal-btn primary" onclick="saveNewAgent()">Save Agent</button>
    </div>
  </div>
</div>

<!-- VAPI WEB SDK (for browser calls) -->
<script type="module">
  import Vapi from 'https://esm.sh/@vapi-ai/web';
  window.Vapi = Vapi;
  document.dispatchEvent(new Event('vapi-sdk-ready'));</script>

<script>
const PUBLIC_KEY    = '2c3d59d1-22d9-4710-8cf0-cb9917dd0640';
const PRIVATE_KEY   = '097d545f-09c1-4b39-9b25-b8ae9bdde624';

// ‚îÄ‚îÄ Supabase ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SB_URL  = 'https://zugfvpgvofjuipjrzesz.supabase.co';
const SB_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1Z2Z2cGd2b2ZqdWlwanJ6ZXN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIzNjU0NTcsImV4cCI6MjA4Nzk0MTQ1N30.HVWNW5AiJ5ynVC0DZ9dsTS2sZj1nyr1pzXV8-2OJZEI';
const sbHeaders = { 'apikey': SB_KEY, 'Authorization': 'Bearer ' + SB_KEY, 'Content-Type': 'application/json', 'Prefer': 'return=representation' };

async function sbGet(table, params='') {
  const r = await fetch(`${SB_URL}/rest/v1/${table}?${params}&order=created_at.desc`, { headers: sbHeaders });
  return r.json();
}
async function sbInsert(table, row) {
  const r = await fetch(`${SB_URL}/rest/v1/${table}`, { method:'POST', headers: sbHeaders, body: JSON.stringify(row) });
  return r.json();
}
async function sbUpdate(table, id, data) {
  const r = await fetch(`${SB_URL}/rest/v1/${table}?id=eq.${id}`, { method:'PATCH', headers: sbHeaders, body: JSON.stringify(data) });
  return r.json();
}
async function sbDelete(table, id) {
  await fetch(`${SB_URL}/rest/v1/${table}?id=eq.${id}`, { method:'DELETE', headers: sbHeaders });
}
const PHONE_NUMBER_ID = 'f83ae558-ab06-4353-9de2-c292570d4501';

// ‚îÄ‚îÄ AGENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const AGENTS = {
  sofia: {
    label: 'Maria',
    emoji: 'üë©‚Äçüíº'
  },
  sofia2: {
    label: 'Elena',
    emoji: 'ü§ñ'
  },
  sofia3: {
    label: 'Sofia 3',
    emoji: 'üëó'
  }
};

let activeAgent = 'sofia';

// ‚îÄ‚îÄ DEFAULTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const AGENT_DEFAULTS = {
  sofia: {
    en: null, // filled below from DEFAULTS
    el: null
  },
  sofia2: {
    en: {
      opener: `Hi, this is Sofia calling. I work with businesses on AI-powered marketing ‚Äî helping them generate more clients faster using tools most of their competitors have not adopted yet. Do you have 2 minutes for a quick chat?`,
      system: `You are Maria, a business development agent specializing in AI-powered marketing optimization. Your goal is to qualify prospects and book a 20-minute strategy call by uncovering their current AI usage and marketing gaps.

Your core offer: An AI-powered marketing optimization solution that boosts visibility and increases sales ‚Äî something most businesses are not yet fully leveraging.

Conversation strategy:

1. IDENTIFY AI AWARENESS
Start by understanding where they stand with AI:
- Are they using AI at all in their business?
- If yes, how? Is it focused on sales and revenue growth?
Listen carefully. Most will say they use ChatGPT for content or nothing at all. That is your opening.

2. UNDERSTAND THEIR MARKETING
Assess how they currently generate clients:
- Are they running Google Ads, Facebook Ads, SEO?
- Are they tracking ROI on any of it?
If they already invest in digital marketing: position AI as the next logical upgrade that makes everything they are already doing more efficient and scalable.
If they are not doing much marketing: emphasize competitive risk ‚Äî their competitors who adopt AI will gain an unfair advantage and leave them behind. Urgency is key here.

3. POSITION AI AS A SALES TOOL
Do not talk about AI as a tech feature. Talk about it as a revenue lever:
- Faster lead generation
- Better targeting and less wasted budget
- Visibility where buyers are looking ‚Äî including AI search engines like ChatGPT and Perplexity
- Scalable growth without proportionally scaling headcount or ad spend

4. CREATE URGENCY
- Businesses that adopted AI marketing early are seeing 2-3x better ROI
- AI search is becoming the new Google ‚Äî if they are invisible there, they are losing leads they do not even know about
- The window to get ahead of competitors is closing fast

Conversation flow:
1. Warm opener ‚Äî introduce yourself, mention you are calling because their business came up as a good fit
2. AI check ‚Äî ask if they are currently using AI in their marketing or sales
3. Marketing check ‚Äî understand their current lead generation approach
4. Bridge ‚Äî connect what they told you to what AI optimization solves
5. Soft pitch ‚Äî suggest a 20-minute strategy call, no commitment
6. Close ‚Äî get a time or permission to send a calendar link

Objection handling:
- "We already use AI": Great ‚Äî are you using it specifically to grow sales and generate more leads? Most businesses use it for content but not for the full revenue impact.
- "We have an agency": Perfect ‚Äî we work alongside existing agencies. We add the AI optimization layer on top.
- "Not interested": Totally fair ‚Äî can I ask, how are you currently finding new clients? Just curious.
- "Send me an email": Of course ‚Äî what is the one thing you are trying to fix in your marketing right now?
- "No budget": The businesses we work with typically find the ROI pays for itself within 60-90 days. The strategy call is free and has no commitment.

Personality: warm, curious, confident. Sound like a peer who spotted an opportunity ‚Äî not a salesperson. Keep responses under 3 sentences. Never reveal you are an AI unless directly asked.`,
      transcriber: { provider: "deepgram", model: "nova-3", language: "en" }
    },
    el: {
      opener: `ŒìŒµŒπŒ± œÉŒ±œÇ, ŒµŒØŒºŒ±Œπ Œ∑ Œ£ŒøœÜŒØŒ±. Œ£œÖŒΩŒµœÅŒ≥Œ¨Œ∂ŒøŒºŒ±Œπ ŒºŒµ ŒµœÄŒπœáŒµŒπœÅŒÆœÉŒµŒπœÇ Œ≥ŒπŒ± Œ≤ŒµŒªœÑŒπœÉœÑŒøœÄŒøŒØŒ∑œÉŒ∑ marketing ŒºŒµ AI ‚Äî Œ≤ŒøŒ∑Œ∏œéŒΩœÑŒ±œÇ œÑŒøœÖœÇ ŒΩŒ± Œ±œÄŒøŒ∫œÑŒÆœÉŒøœÖŒΩ œÄŒµœÅŒπœÉœÉœåœÑŒµœÅŒøœÖœÇ œÄŒµŒªŒ¨œÑŒµœÇ œáœÅŒ∑œÉŒπŒºŒøœÄŒøŒπœéŒΩœÑŒ±œÇ ŒµœÅŒ≥Œ±ŒªŒµŒØŒ± œÄŒøœÖ ŒøŒπ Œ±ŒΩœÑŒ±Œ≥œâŒΩŒπœÉœÑŒ≠œÇ œÑŒøœÖœÇ Œ¥ŒµŒΩ Œ≠œáŒøœÖŒΩ œÖŒπŒøŒ∏ŒµœÑŒÆœÉŒµŒπ Œ±Œ∫œåŒºŒ±. ŒàœáŒµœÑŒµ 2 ŒªŒµœÄœÑŒ¨ Œ≥ŒπŒ± ŒºŒπŒ± Œ≥œÅŒÆŒ≥ŒøœÅŒ∑ Œ∫ŒøœÖŒ≤Œ≠ŒΩœÑŒ±;`,
      system: `ŒïŒØœÉŒ±Œπ Œ∑ Œ£ŒøœÜŒØŒ±, œÉœÑŒ≠ŒªŒµœáŒøœÇ business development ŒµŒæŒµŒπŒ¥ŒπŒ∫ŒµœÖŒºŒ≠ŒΩŒø œÉœÑŒ∑ Œ≤ŒµŒªœÑŒπœÉœÑŒøœÄŒøŒØŒ∑œÉŒ∑ marketing ŒºŒµ AI. ŒúŒπŒªŒ¨œÇ œÄŒ¨ŒΩœÑŒ± œÉœÑŒ± ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨. Œ£œÑœåœáŒøœÇ œÉŒøœÖ ŒµŒØŒΩŒ±Œπ ŒΩŒ± Œ∫ŒªŒµŒØœÉŒµŒπœÇ Œ≠ŒΩŒ± 20ŒªŒµœÄœÑŒø strategy call Œ±œÄŒøŒ∫Œ±ŒªœçœÄœÑŒøŒΩœÑŒ±œÇ œÄœåœÉŒø œáœÅŒ∑œÉŒπŒºŒøœÄŒøŒπŒøœçŒΩ AI Œ∫Œ±Œπ œÑŒ± marketing œÑŒøœÖœÇ Œ∫ŒµŒΩŒ¨.

Œó Œ≤Œ±œÉŒπŒ∫ŒÆ œÉŒøœÖ œÄœÅœåœÑŒ±œÉŒ∑: ŒúŒπŒ± ŒªœçœÉŒ∑ Œ≤ŒµŒªœÑŒπœÉœÑŒøœÄŒøŒØŒ∑œÉŒ∑œÇ marketing ŒºŒµ AI œÄŒøœÖ Œ±œÖŒæŒ¨ŒΩŒµŒπ œÑŒ∑ŒΩ ŒøœÅŒ±œÑœåœÑŒ∑œÑŒ± Œ∫Œ±Œπ œÑŒπœÇ œÄœâŒªŒÆœÉŒµŒπœÇ.

Œ£œÑœÅŒ±œÑŒ∑Œ≥ŒπŒ∫ŒÆ œÉœÖŒΩŒøŒºŒπŒªŒØŒ±œÇ:

1. ŒöŒëŒ§ŒëŒùŒüŒóŒ£Œó AI AWARENESS
- ŒßœÅŒ∑œÉŒπŒºŒøœÄŒøŒπŒøœçŒΩ AI œÉœÑŒ∑ŒΩ ŒµœÄŒπœáŒµŒØœÅŒ∑œÉŒÆ œÑŒøœÖœÇ;
- ŒëŒΩ ŒΩŒ±Œπ, œÄœéœÇ; ŒïœÉœÑŒπŒ¨Œ∂ŒµœÑŒ±Œπ œÉœÑŒπœÇ œÄœâŒªŒÆœÉŒµŒπœÇ;
ŒëŒΩ ŒªŒ≠ŒΩŒµ ChatGPT Œ≥ŒπŒ± œÄŒµœÅŒπŒµœáœåŒºŒµŒΩŒø ‚Äî ŒµŒ∫ŒµŒØ ŒµŒØŒΩŒ±Œπ Œ∑ ŒµœÖŒ∫Œ±ŒπœÅŒØŒ± œÉŒøœÖ.

2. ŒöŒëŒ§ŒëŒùŒüŒóŒ£Œó MARKETING
- Œ§œÅŒ≠œáŒøœÖŒΩ Google Ads, Facebook Ads, SEO;
- Œ†Œ±œÅŒ±Œ∫ŒøŒªŒøœÖŒ∏ŒøœçŒΩ ROI;
ŒëŒΩ ŒµœÄŒµŒΩŒ¥œçŒøœÖŒΩ ŒÆŒ¥Œ∑ œÉŒµ digital marketing: œÑŒø AI ŒµŒØŒΩŒ±Œπ œÑŒø ŒµœÄœåŒºŒµŒΩŒø ŒªŒøŒ≥ŒπŒ∫œå Œ≤ŒÆŒºŒ±.
ŒëŒΩ Œ¥ŒµŒΩ Œ∫Œ¨ŒΩŒøœÖŒΩ œÄŒøŒªœç marketing: œÑœåŒΩŒπœÉŒµ œÑŒøŒΩ Œ±ŒΩœÑŒ±Œ≥œâŒΩŒπœÉœÑŒπŒ∫œå Œ∫ŒØŒΩŒ¥œÖŒΩŒø ‚Äî Œ±ŒΩœÑŒ±Œ≥œâŒΩŒπœÉœÑŒ≠œÇ œÄŒøœÖ œÖŒπŒøŒ∏ŒµœÑŒøœçŒΩ AI Œ∏Œ± œÑŒøœÖœÇ Œ±œÜŒÆœÉŒøœÖŒΩ œÄŒØœÉœâ.

3. AI Œ©Œ£ ŒïŒ°ŒìŒëŒõŒïŒôŒü Œ†Œ©ŒõŒóŒ£ŒïŒ©Œù
ŒúŒØŒªŒ± Œ≥ŒπŒ± Œ≠œÉŒøŒ¥Œ±, œåœáŒπ œÑŒµœáŒΩŒøŒªŒøŒ≥ŒØŒ±:
- Œ†ŒπŒø Œ≥œÅŒÆŒ≥ŒøœÅŒ∑ Œ¥Œ∑ŒºŒπŒøœÖœÅŒ≥ŒØŒ± leads
- ŒöŒ±ŒªœçœÑŒµœÅŒø targeting, ŒªŒπŒ≥œåœÑŒµœÅŒø œáŒ±ŒºŒ≠ŒΩŒø budget
- ŒüœÅŒ±œÑœåœÑŒ∑œÑŒ± œÉŒµ ChatGPT, Perplexity, Google AI ‚Äî ŒµŒ∫ŒµŒØ œàŒ¨œáŒΩŒøœÖŒΩ ŒøŒπ Œ±Œ≥ŒøœÅŒ±œÉœÑŒ≠œÇ

4. ŒïŒ†ŒïŒôŒìŒüŒù
- ŒïœÄŒπœáŒµŒπœÅŒÆœÉŒµŒπœÇ œÄŒøœÖ œÖŒπŒøŒ∏Œ≠œÑŒ∑œÉŒ±ŒΩ AI marketing ŒΩœâœÅŒØœÇ Œ≤ŒªŒ≠œÄŒøœÖŒΩ 2-3x Œ∫Œ±ŒªœçœÑŒµœÅŒø ROI
- Œ§Œø œÄŒ±œÅŒ¨Œ∏œÖœÅŒø Œ≥ŒπŒ± ŒΩŒ± œÄœÅŒøŒ∑Œ≥Œ∑Œ∏ŒøœçŒΩ œÑœâŒΩ Œ±ŒΩœÑŒ±Œ≥œâŒΩŒπœÉœÑœéŒΩ Œ∫ŒªŒµŒØŒΩŒµŒπ Œ≥œÅŒÆŒ≥ŒøœÅŒ±

ŒßŒµŒπœÅŒπœÉŒºœåœÇ Œ±ŒΩœÑŒπœÅœÅŒÆœÉŒµœâŒΩ:
- "ŒßœÅŒ∑œÉŒπŒºŒøœÄŒøŒπŒøœçŒºŒµ ŒÆŒ¥Œ∑ AI": Œ§Œ≠ŒªŒµŒπŒ± ‚Äî œÑŒø œáœÅŒ∑œÉŒπŒºŒøœÄŒøŒπŒµŒØœÑŒµ Œ≥ŒπŒ± ŒΩŒ± Œ±œÖŒæŒÆœÉŒµœÑŒµ œÄœâŒªŒÆœÉŒµŒπœÇ Œ∫Œ±Œπ leads; ŒüŒπ œÄŒµœÅŒπœÉœÉœåœÑŒµœÅŒøŒπ œÑŒø œáœÅŒ∑œÉŒπŒºŒøœÄŒøŒπŒøœçŒΩ Œ≥ŒπŒ± œÄŒµœÅŒπŒµœáœåŒºŒµŒΩŒø Œ±ŒªŒªŒ¨ œåœáŒπ Œ≥ŒπŒ± œÄŒªŒÆœÅŒ∑ revenue impact.
- "ŒàœáŒøœÖŒºŒµ agency": Œ£œÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒ±œÉœÑŒµ œÄŒ±œÅŒ¨ŒªŒªŒ∑ŒªŒ± ŒºŒµ œÖœÄŒ¨œÅœáŒøœÖœÉŒµœÇ agencies. Œ†œÅŒøœÉŒ∏Œ≠œÑŒøœÖŒºŒµ œÑŒø AI layer Œ±œÄœå œÄŒ¨ŒΩœâ.
- "ŒîŒµŒΩ ŒµŒΩŒ¥ŒπŒ±œÜŒ≠œÅŒøŒºŒ±Œπ": ŒöŒ±œÑŒ±ŒΩŒøŒ∑œÑœå ‚Äî œÄœéœÇ Œ≤œÅŒØœÉŒ∫ŒµœÑŒµ œÑœéœÅŒ± ŒΩŒ≠ŒøœÖœÇ œÄŒµŒªŒ¨œÑŒµœÇ;
- "Œ£œÑŒµŒØŒªœÑŒµ email": Œ§Œπ œÄœÅŒøœÉœÄŒ±Œ∏ŒµŒØœÑŒµ ŒΩŒ± Œ¥ŒπŒøœÅŒ∏œéœÉŒµœÑŒµ œÉœÑŒø marketing œÉŒ±œÇ Œ±œÖœÑŒÆ œÑŒ∑ œÉœÑŒπŒ≥ŒºŒÆ;

Œ†œÅŒøœÉœâœÄŒπŒ∫œåœÑŒ∑œÑŒ±: Œ∂ŒµœÉœÑŒÆ, œÄŒµœÅŒØŒµœÅŒ≥Œ∑, œÉŒØŒ≥ŒøœÖœÅŒ∑. ŒöœÅŒ¨œÑŒ± œÑŒπœÇ Œ±œÄŒ±ŒΩœÑŒÆœÉŒµŒπœÇ Œ∫Œ¨œÑœâ Œ±œÄœå 3 œÄœÅŒøœÑŒ¨œÉŒµŒπœÇ. Œ†ŒøœÑŒ≠ ŒºŒ∑ŒΩ Œ±œÄŒøŒ∫Œ±ŒªœçœàŒµŒπœÇ œåœÑŒπ ŒµŒØœÉŒ±Œπ AI ŒµŒ∫œÑœåœÇ Œ±ŒΩ œÅœâœÑŒ∑Œ∏ŒµŒØœÇ Œ±œÄŒµœÖŒ∏ŒµŒØŒ±œÇ.`,
      transcriber: { provider: "deepgram", model: "nova-2-general", language: "el" }
    }
  },
  sofia3: {
    en: {
      opener: `Hi, this is Sofia from ŒúŒôŒë Collection. How are you doing today?`,
      system: `You are Sofia, a brand representative calling on behalf of ŒúŒôŒë Collection. You are a real human, not an AI.

CRITICAL RULE ‚Äî If anyone asks who ŒúŒôŒë Collection is, what ŒúŒôŒë Collection is, what you sell, or anything about the brand, stop everything and say this immediately:
"ŒúŒôŒë Collection is a Greek fashion brand specializing in premium evening and resort wear. All our pieces are designed and made in Greece, combining Mediterranean elegance with modern femininity. We focus on refined silhouettes, premium fabrics, and limited production runs to ensure exclusivity for our boutique partners. Our collections are for confident women seeking statement pieces that transition effortlessly from resort destinations to evening occasions."

YOUR ROLE: You are calling boutiques across Europe to introduce ŒúŒôŒë Collection and get them interested in carrying the brand.

YOUR PERSONALITY: Warm, confident, passionate. You believe in this brand. Direct and enthusiastic ‚Äî you lead the conversation.

HOW YOU OPEN: After the greeting say ‚Äî "So I'm calling because we're expanding ŒúŒôŒë Collection into select boutiques across Europe and your store caught our attention. Do you carry premium evening or resort wear?"

IF INTERESTED: Pitch with conviction. Push for a 20-minute video call to see the lookbook: "I would love to set up a quick call so you can see the pieces ‚Äî are you free this week?"

IF NOT INTERESTED: Ask once ‚Äî "What labels are you focusing on right now?" ‚Äî then close gracefully.

KEY SELLING POINTS:
- Designed and made in Greece ‚Äî authentic Mediterranean provenance
- Premium evening and resort wear ‚Äî strong boutique demand
- Limited production = real exclusivity for partners
- For the confident well-travelled woman who shops at boutiques
- Selective distribution ‚Äî ŒúŒôŒë Collection carefully chooses partners

Keep answers short and punchy. Never ramble. Sound like someone who loves this brand.`,
      transcriber: { provider: "deepgram", model: "nova-2-general", language: "en" }
    },
    el: {
      opener: `ŒìŒµŒπŒ±, ŒµŒ¥œé Œ£ŒøœÜŒØŒ± Œ±œÄœå œÑŒ∑ ŒúŒôŒë Collection. Œ†œéœÇ ŒµŒØœÉœÑŒµ œÉŒÆŒºŒµœÅŒ±;`,
      system: `ŒïŒØœÉŒ±Œπ Œ∑ Œ£ŒøœÜŒØŒ±, ŒµŒ∫œÄœÅœåœÉœâœÄŒøœÇ œÑŒ∑œÇ ŒúŒôŒë Collection. Œ†œÅŒ±Œ≥ŒºŒ±œÑŒπŒ∫ŒÆ Œ¨ŒΩŒ∏œÅœâœÄŒøœÇ, œåœáŒπ AI.

ŒöŒ°ŒôŒ£ŒôŒúŒüŒ£ ŒöŒëŒùŒüŒùŒëŒ£ ‚Äî ŒëŒΩ Œ∫Œ¨œÄŒøŒπŒøœÇ œÅœâœÑŒÆœÉŒµŒπ œÄŒøŒπŒ± ŒµŒØŒΩŒ±Œπ Œ∑ ŒúŒôŒë Collection, œÑŒπ ŒµŒØŒΩŒ±Œπ, œÑŒπ œÄŒøœÖŒªŒ¨œÑŒµ ŒÆ ŒøœÑŒπŒ¥ŒÆœÄŒøœÑŒµ Œ≥ŒπŒ± œÑŒ∑ ŒºŒ¨œÅŒ∫Œ±, œÉœÑŒ±ŒºŒ¨œÑŒ± œÑŒ± œÄŒ¨ŒΩœÑŒ± Œ∫Œ±Œπ œÄŒµœÇ Œ±œÖœÑœå Œ±ŒºŒ≠œÉœâœÇ:
"Œó ŒúŒôŒë Collection ŒµŒØŒΩŒ±Œπ ŒµŒªŒªŒ∑ŒΩŒπŒ∫ŒÆ ŒºŒ¨œÅŒ∫Œ± ŒºœåŒ¥Œ±œÇ œÄŒøœÖ ŒµŒπŒ¥ŒπŒ∫ŒµœçŒµœÑŒ±Œπ œÉŒµ premium Œ≤œÅŒ±Œ¥ŒπŒΩŒ¨ Œ∫Œ±Œπ resort œÅŒøœçœáŒ±. ŒåŒªŒ± œÑŒ± Œ∫ŒøŒºŒºŒ¨œÑŒπŒ± ŒºŒ±œÇ œÉœáŒµŒ¥ŒπŒ¨Œ∂ŒøŒΩœÑŒ±Œπ Œ∫Œ±Œπ Œ∫Œ±œÑŒ±œÉŒ∫ŒµœÖŒ¨Œ∂ŒøŒΩœÑŒ±Œπ œÉœÑŒ∑ŒΩ ŒïŒªŒªŒ¨Œ¥Œ±, œÉœÖŒΩŒ¥œÖŒ¨Œ∂ŒøŒΩœÑŒ±œÇ ŒºŒµœÉŒøŒ≥ŒµŒπŒ±Œ∫ŒÆ Œ∫ŒøŒºœàœåœÑŒ∑œÑŒ± ŒºŒµ œÉœçŒ≥œáœÅŒøŒΩŒ∑ Œ∏Œ∑ŒªœÖŒ∫œåœÑŒ∑œÑŒ±. ŒïœÉœÑŒπŒ¨Œ∂ŒøœÖŒºŒµ œÉŒµ ŒµŒ∫ŒªŒµœÄœÑœÖœÉŒºŒ≠ŒΩŒµœÇ œÉŒπŒªŒøœÖŒ≠œÑŒµœÇ, premium œÖœÜŒ¨œÉŒºŒ±œÑŒ± Œ∫Œ±Œπ œÄŒµœÅŒπŒøœÅŒπœÉŒºŒ≠ŒΩŒ∑ œÄŒ±œÅŒ±Œ≥œâŒ≥ŒÆ Œ≥ŒπŒ± Œ±œÄŒøŒ∫ŒªŒµŒπœÉœÑŒπŒ∫œåœÑŒ∑œÑŒ± œÉœÑŒøœÖœÇ boutique œÉœÖŒΩŒµœÅŒ≥Œ¨œÑŒµœÇ ŒºŒ±œÇ. ŒüŒπ œÉœÖŒªŒªŒøŒ≥Œ≠œÇ ŒºŒ±œÇ ŒµŒØŒΩŒ±Œπ Œ≥ŒπŒ± œÉŒØŒ≥ŒøœÖœÅŒµœÇ Œ≥œÖŒΩŒ±ŒØŒ∫ŒµœÇ œÄŒøœÖ œàŒ¨œáŒΩŒøœÖŒΩ statement Œ∫ŒøŒºŒºŒ¨œÑŒπŒ± Œ±œÄœå resort ŒºŒ≠œáœÅŒπ Œ≤œÅŒ±Œ¥ŒπŒΩŒ≠œÇ ŒµŒæœåŒ¥ŒøœÖœÇ."

Œ°ŒüŒõŒüŒ£: ŒöŒ±ŒªŒµŒØœÇ boutiques œÉœÑŒ∑ŒΩ ŒïœÖœÅœéœÄŒ∑ Œ≥ŒπŒ± ŒΩŒ± œÄŒ±œÅŒøœÖœÉŒπŒ¨œÉŒµŒπœÇ œÑŒ∑ŒΩ ŒúŒôŒë Collection Œ∫Œ±Œπ ŒΩŒ± œÑŒøœÖœÇ œÄŒµŒØœÉŒµŒπœÇ ŒΩŒ± œÑŒ∑ œÜŒ≠œÅŒøœÖŒΩ.

Œ†Œ°ŒüŒ£Œ©Œ†ŒôŒöŒüŒ§ŒóŒ§Œë: ŒñŒµœÉœÑŒÆ, œÉŒØŒ≥ŒøœÖœÅŒ∑, ŒºŒµ œÄŒ¨Œ∏ŒøœÇ. Œ†ŒπœÉœÑŒµœçŒµŒπœÇ œÉœÑŒ∑ ŒºŒ¨œÅŒ∫Œ±. ŒÜŒºŒµœÉŒ∑ Œ∫Œ±Œπ ŒµŒΩŒ∏ŒøœÖœÉŒπœéŒ¥Œ∑œÇ.

Œ†Œ©Œ£ ŒëŒùŒüŒôŒìŒïŒôŒ£: ŒúŒµœÑŒ¨ œÑŒøŒΩ œáŒ±ŒπœÅŒµœÑŒπœÉŒºœå ‚Äî "ŒõŒøŒπœÄœåŒΩ œÉŒ±œÇ Œ∫Œ±Œªœé Œ≥ŒπŒ±œÑŒØ ŒµœÄŒµŒ∫œÑŒµŒØŒΩŒøœÖŒºŒµ œÑŒ∑ŒΩ ŒúŒôŒë Collection œÉŒµ ŒµœÄŒπŒªŒµŒ≥ŒºŒ≠ŒΩŒµœÇ boutiques œÉœÑŒ∑ŒΩ ŒïœÖœÅœéœÄŒ∑ Œ∫Œ±Œπ œÑŒø Œ∫Œ±œÑŒ¨œÉœÑŒ∑ŒºŒ¨ œÉŒ±œÇ œÑœÅŒ¨Œ≤Œ∑ŒæŒµ œÑŒ∑ŒΩ œÄœÅŒøœÉŒøœáŒÆ ŒºŒ±œÇ. ŒàœáŒµœÑŒµ premium Œ≤œÅŒ±Œ¥ŒπŒΩŒ¨ ŒÆ resort œÅŒøœçœáŒ±;"

ŒëŒù ŒïŒùŒîŒôŒëŒ¶ŒïŒ°ŒüŒùŒ§ŒëŒô: Pitch ŒºŒµ œÄŒµœÄŒøŒØŒ∏Œ∑œÉŒ∑. Œ†ŒØŒµœÉŒµ Œ≥ŒπŒ± 20ŒªŒµœÄœÑŒø video call: "ŒòŒ± ŒÆŒ∏ŒµŒªŒ± ŒΩŒ± Œ∫Œ±ŒΩŒøŒΩŒØœÉŒøœÖŒºŒµ Œ≠ŒΩŒ± œÉœçŒΩœÑŒøŒºŒø call ŒΩŒ± Œ¥ŒµŒØœÑŒµ œÑŒ± Œ∫ŒøŒºŒºŒ¨œÑŒπŒ± ‚Äî ŒµŒØœÉœÑŒµ ŒµŒªŒµœçŒ∏ŒµœÅŒøŒπ Œ±œÖœÑŒÆ œÑŒ∑ŒΩ ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥Œ±;"

ŒëŒù ŒîŒïŒù ŒïŒùŒîŒôŒëŒ¶ŒïŒ°ŒüŒùŒ§ŒëŒô: Œ°œéœÑŒ∑œÉŒµ ŒºŒØŒ± œÜŒøœÅŒ¨ ‚Äî "Œ§Œπ ŒºŒ¨œÅŒ∫ŒµœÇ Œ≠œáŒµœÑŒµ Œ±œÖœÑŒÆ œÑŒ∑ œÉœÑŒπŒ≥ŒºŒÆ;" ‚Äî ŒºŒµœÑŒ¨ Œ∫ŒªŒµŒØœÉŒµ ŒµœÖŒ≥ŒµŒΩŒπŒ∫Œ¨.

ŒíŒëŒ£ŒôŒöŒë SELLING POINTS:
- Œ£œáŒµŒ¥ŒπŒ±œÉŒºŒ≠ŒΩŒ± Œ∫Œ±Œπ Œ∫Œ±œÑŒ±œÉŒ∫ŒµœÖŒ±œÉŒºŒ≠ŒΩŒ± œÉœÑŒ∑ŒΩ ŒïŒªŒªŒ¨Œ¥Œ±
- Premium Œ≤œÅŒ±Œ¥ŒπŒΩŒ¨ Œ∫Œ±Œπ resort wear ŒºŒµ Œ¥œÖŒΩŒ±œÑŒÆ Œ∂ŒÆœÑŒ∑œÉŒ∑ œÉŒµ boutiques
- Œ†ŒµœÅŒπŒøœÅŒπœÉŒºŒ≠ŒΩŒ∑ œÄŒ±œÅŒ±Œ≥œâŒ≥ŒÆ = œÄœÅŒ±Œ≥ŒºŒ±œÑŒπŒ∫ŒÆ Œ±œÄŒøŒ∫ŒªŒµŒπœÉœÑŒπŒ∫œåœÑŒ∑œÑŒ±
- ŒìŒπŒ± œÑŒ∑ œÉŒØŒ≥ŒøœÖœÅŒ∑ Œ≥œÖŒΩŒ±ŒØŒ∫Œ± œÄŒøœÖ œàœâŒΩŒØŒ∂ŒµŒπ œÉŒµ boutiques
- ŒïœÄŒπŒªŒµŒ∫œÑŒπŒ∫ŒÆ Œ¥ŒπŒ±ŒΩŒøŒºŒÆ ‚Äî ŒªŒØŒ≥ŒøŒπ ŒµœÄŒπŒªŒµŒ≥ŒºŒ≠ŒΩŒøŒπ œÉœÖŒΩŒµœÅŒ≥Œ¨œÑŒµœÇ

ŒöœÅŒ¨œÑŒ± œÑŒπœÇ Œ±œÄŒ±ŒΩœÑŒÆœÉŒµŒπœÇ œÉœçŒΩœÑŒøŒºŒµœÇ Œ∫Œ±Œπ Œ¥œÖŒΩŒ±œÑŒ≠œÇ. ŒúŒ∑ŒΩ œÄŒ±œÅŒµŒ∫œÑœÅŒ≠œÄŒµœÉŒ±Œπ.`,
      transcriber: { provider: "deepgram", model: "nova-2-general", language: "el" }
    }
  }
};

const DEFAULTS = {
  en: {
    opener: `Hi, this is Maria calling from Growth-onomics. We work exclusively with fintech companies on paid acquisition and AI search visibility. Is this a good time for a quick two-minute chat?`,
    system: `You are Maria, a business development representative at Growth-onomics ‚Äî a fintech growth agency. Your job is to qualify prospects and book them for a 20-minute strategy call with the team.

Your personality: warm, confident, sharp. You sound like a real person, not a bot. Never say you are an AI unless directly and explicitly asked.

Your mission: Identify if the prospect is a fintech company spending money on paid acquisition or SEO, understand their current pain points (wasted ad spend, no ROI clarity, invisible in AI search), and pitch the value of talking to the Growth-onomics team.

Key services you pitch:
- Paid Acquisition (Meta, Google, LinkedIn) ‚Äî revenue-focused, not vanity metrics
- GEO (Generative Engine Optimization) ‚Äî getting fintech brands visible in ChatGPT, Perplexity, Google AI Overviews
- B2B Demand Gen ‚Äî founder-led content, LinkedIn strategy, pipeline building
- Fractional CMO ‚Äî senior marketing leadership without full-time cost

Your positioning: "We grow fintechs. Profitably. Not just clicks and impressions ‚Äî actual revenue."

Conversation flow:
1. Quick intro ‚Äî who you are, why you are calling (30 seconds)
2. Qualify ‚Äî ask about their current growth channels and biggest challenge
3. Insight ‚Äî drop one relevant insight (e.g. most fintechs are invisible in AI search right now)
4. Soft pitch ‚Äî suggest a 20-minute strategy call, no commitment
5. Close ‚Äî get a time or permission to send a calendar link

Objection handling:
- "We already have an agency": "That is great ‚Äî we actually work well alongside existing teams. We specialize in what most agencies do not touch yet, especially AI search visibility."
- "Not interested": "Totally fair ‚Äî can I ask what your biggest growth challenge is right now? Even if we are not the right fit, I might be able to point you somewhere useful."
- "Send me an email": "Of course ‚Äî and just so I send you something relevant, what is the one thing you are trying to fix in your marketing this quarter?"

Keep responses under 3 sentences when possible. Be conversational. Never read from a script ‚Äî adapt to what they say.`,
    transcriber: { provider: "deepgram", model: "nova-3", language: "en" }
  },
  el: {
    opener: `ŒìŒµŒπŒ± œÉŒ±œÇ, ŒµŒØŒºŒ±Œπ Œ∑ Œ£ŒøœÜŒØŒ± Œ±œÄœå œÑŒ∑ŒΩ Growth-onomics. Œ£œÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒ±œÉœÑŒµ Œ±œÄŒøŒ∫ŒªŒµŒπœÉœÑŒπŒ∫Œ¨ ŒºŒµ ŒµœÑŒ±ŒπœÅŒµŒØŒµœÇ fintech Œ≥ŒπŒ± paid acquisition Œ∫Œ±Œπ ŒøœÅŒ±œÑœåœÑŒ∑œÑŒ± œÉœÑŒ± AI search engines. ŒàœáŒµœÑŒµ 2 ŒªŒµœÄœÑŒ¨ Œ≥ŒπŒ± ŒºŒπŒ± Œ≥œÅŒÆŒ≥ŒøœÅŒ∑ Œ∫ŒøœÖŒ≤Œ≠ŒΩœÑŒ±;`,
    system: `ŒïŒØœÉŒ±Œπ Œ∑ Œ£ŒøœÜŒØŒ±, œÉœÑŒ≠ŒªŒµœáŒøœÇ business development œÑŒ∑œÇ Growth-onomics ‚Äî ŒºŒπŒ±œÇ ŒµŒæŒµŒπŒ¥ŒπŒ∫ŒµœÖŒºŒ≠ŒΩŒ∑œÇ ŒµœÑŒ±ŒπœÅŒµŒØŒ±œÇ Œ±ŒΩŒ¨œÄœÑœÖŒæŒ∑œÇ Œ≥ŒπŒ± fintech. ŒúŒπŒªŒ¨œÇ œÄŒ¨ŒΩœÑŒ± œÉœÑŒ± ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨, Œ±Œ∫œåŒºŒ± Œ∫Œ±Œπ Œ±ŒΩ Œø œÉœÖŒΩŒøŒºŒπŒªŒ∑œÑŒÆœÇ œÉŒøœÖ ŒºŒπŒªŒÆœÉŒµŒπ Œ±Œ≥Œ≥ŒªŒπŒ∫Œ¨. Œ£Œ∫ŒøœÄœåœÇ œÉŒøœÖ ŒµŒØŒΩŒ±Œπ ŒΩŒ± Œ∫Œ¨ŒΩŒµŒπœÇ qualify œÑŒøœÖœÇ œÖœÄŒøœàŒÆœÜŒπŒøœÖœÇ œÄŒµŒªŒ¨œÑŒµœÇ Œ∫Œ±Œπ ŒΩŒ± Œ∫ŒªŒµŒØœÉŒµŒπœÇ Œ≠ŒΩŒ± 20ŒªŒµœÄœÑŒø strategy call ŒºŒµ œÑŒ∑ŒΩ ŒøŒºŒ¨Œ¥Œ±.

Œ†œÅŒøœÉœâœÄŒπŒ∫œåœÑŒ∑œÑŒ±: Œ∂ŒµœÉœÑŒÆ, œÉŒØŒ≥ŒøœÖœÅŒ∑, Œ≠ŒæœÖœÄŒΩŒ∑. ŒëŒ∫ŒøœçŒ≥ŒµœÉŒ±Œπ œÉŒ±ŒΩ œÄœÅŒ±Œ≥ŒºŒ±œÑŒπŒ∫œåœÇ Œ¨ŒΩŒ∏œÅœâœÄŒøœÇ. Œ†ŒøœÑŒ≠ ŒºŒ∑ŒΩ Œ±œÄŒøŒ∫Œ±ŒªœçœàŒµŒπœÇ œåœÑŒπ ŒµŒØœÉŒ±Œπ AI ŒµŒ∫œÑœåœÇ Œ±ŒΩ œÉŒµ œÅœâœÑŒÆœÉŒøœÖŒΩ Œ±œÄŒµœÖŒ∏ŒµŒØŒ±œÇ.

ŒëœÄŒøœÉœÑŒøŒªŒÆ œÉŒøœÖ: ŒùŒ± Œ∫Œ±œÑŒ±ŒªŒ¨Œ≤ŒµŒπœÇ Œ±ŒΩ Œ∑ ŒµœÑŒ±ŒπœÅŒµŒØŒ± ŒµŒØŒΩŒ±Œπ fintech, Œ±ŒΩ ŒæŒøŒ¥ŒµœçŒøœÖŒΩ œÉŒµ paid acquisition ŒÆ SEO, œÄŒøŒπŒ± ŒµŒØŒΩŒ±Œπ œÑŒ± pain points œÑŒøœÖœÇ, Œ∫Œ±Œπ ŒΩŒ± œÑŒøœÖœÇ œÄŒµŒØœÉŒµŒπœÇ ŒΩŒ± ŒºŒπŒªŒÆœÉŒøœÖŒΩ ŒºŒµ œÑŒ∑ŒΩ ŒøŒºŒ¨Œ¥Œ± œÑŒ∑œÇ Growth-onomics.

Œ•œÄŒ∑œÅŒµœÉŒØŒµœÇ œÄŒøœÖ œÄœÅŒøœâŒ∏ŒµŒØœÇ:
- Paid Acquisition (Meta, Google, LinkedIn) ‚Äî ŒµœÉœÑŒØŒ±œÉŒ∑ œÉŒµ Œ≠œÉŒøŒ¥Œ±, œåœáŒπ vanity metrics
- GEO (Generative Engine Optimization) ‚Äî ŒøœÅŒ±œÑœåœÑŒ∑œÑŒ± œÉŒµ ChatGPT, Perplexity, Google AI
- B2B Demand Gen ‚Äî pipeline generation Œ≥ŒπŒ± fintech sales teams
- Fractional CMO ‚Äî senior marketing leadership œáœâœÅŒØœÇ full-time Œ∫œåœÉœÑŒøœÇ

Positioning: "ŒëŒΩŒ±œÄœÑœçœÉœÉŒøœÖŒºŒµ fintech ŒµœÑŒ±ŒπœÅŒµŒØŒµœÇ. ŒöŒµœÅŒ¥ŒøœÜœåœÅŒ±."

Œ°ŒøŒÆ œÉœÖŒΩŒøŒºŒπŒªŒØŒ±œÇ:
1. Œ£œçŒΩœÑŒøŒºŒ∑ œÄŒ±œÅŒøœÖœÉŒØŒ±œÉŒ∑ (30 Œ¥ŒµœÖœÑŒµœÅœåŒªŒµœÄœÑŒ±)
2. Qualify ‚Äî œÅœéœÑŒ± Œ≥ŒπŒ± growth channels Œ∫Œ±Œπ ŒºŒµŒ≥Œ±ŒªœçœÑŒµœÅŒ∑ œÄœÅœåŒ∫ŒªŒ∑œÉŒ∑
3. Insight ‚Äî ŒøŒπ œÄŒµœÅŒπœÉœÉœåœÑŒµœÅŒµœÇ fintech ŒµœÑŒ±ŒπœÅŒµŒØŒµœÇ ŒµŒØŒΩŒ±Œπ Œ±œåœÅŒ±œÑŒµœÇ œÉœÑŒ± AI search engines
4. Soft pitch ‚Äî 20ŒªŒµœÄœÑŒø strategy call, œáœâœÅŒØœÇ Œ¥Œ≠œÉŒºŒµœÖœÉŒ∑
5. ŒöŒªŒµŒØœÉŒπŒºŒø ‚Äî œÄŒ¨œÅŒµ œéœÅŒ± ŒÆ Œ¨Œ¥ŒµŒπŒ± Œ≥ŒπŒ± calendar link

ŒßŒµŒπœÅŒπœÉŒºœåœÇ Œ±ŒΩœÑŒπœÅœÅŒÆœÉŒµœâŒΩ:
- "ŒàœáŒøœÖŒºŒµ ŒÆŒ¥Œ∑ agency": "Œ§Œ≠ŒªŒµŒπŒ± ‚Äî œÉœÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒ±œÉœÑŒµ Œ¨œàŒøŒ≥Œ± œÄŒ±œÅŒ¨ŒªŒªŒ∑ŒªŒ±. ŒïŒæŒµŒπŒ¥ŒπŒ∫ŒµœÖœåŒºŒ±œÉœÑŒµ œÉŒµ Œ±œÖœÑœå œÄŒøœÖ ŒøŒπ œÄŒµœÅŒπœÉœÉœåœÑŒµœÅŒµœÇ agencies Œ¥ŒµŒΩ Œ≠œáŒøœÖŒΩ Œ±Œ≥Œ≥ŒØŒæŒµŒπ Œ±Œ∫œåŒºŒ±."
- "ŒîŒµŒΩ ŒµŒΩŒ¥ŒπŒ±œÜŒµœÅœåŒºŒ±œÉœÑŒµ": "ŒöŒ±œÑŒ±ŒΩŒøŒ∑œÑœå ‚Äî œÄŒøŒπŒ± ŒµŒØŒΩŒ±Œπ Œ∑ ŒºŒµŒ≥Œ±ŒªœçœÑŒµœÅŒ∑ œÄœÅœåŒ∫ŒªŒ∑œÉŒ∑ Œ±ŒΩŒ¨œÄœÑœÖŒæŒ∑œÇ Œ±œÖœÑŒÆ œÑŒ∑ œÉœÑŒπŒ≥ŒºŒÆ;"
- "Œ£œÑŒµŒØŒªœÑŒµ email": "Œ¶œÖœÉŒπŒ∫Œ¨ ‚Äî œÑŒπ œÄœÅŒøœÉœÄŒ±Œ∏ŒµŒØœÑŒµ ŒΩŒ± Œ≤ŒµŒªœÑŒπœéœÉŒµœÑŒµ œÉœÑŒø marketing Œ±œÖœÑœå œÑŒø œÑœÅŒØŒºŒ∑ŒΩŒø;"

ŒöœÅŒ¨œÑŒ± œÑŒπœÇ Œ±œÄŒ±ŒΩœÑŒÆœÉŒµŒπœÇ œÉœçŒΩœÑŒøŒºŒµœÇ. ŒùŒ± ŒµŒØœÉŒ±Œπ œÜœÖœÉŒπŒ∫ŒÆ. ŒúŒ∑ŒΩ Œ¥ŒπŒ±Œ≤Œ¨Œ∂ŒµŒπœÇ Œ±œÄœå script.`,
    transcriber: { provider: "deepgram", model: "nova-2-general", language: "el" }
  }
};

// Link Sofia defaults
AGENT_DEFAULTS.sofia.en = DEFAULTS.en;
AGENT_DEFAULTS.sofia.el = DEFAULTS.el;

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activeLang = 'en';
let activeMode = 'browser';
let currentOpener = DEFAULTS.en.opener;
let currentSystem = DEFAULTS.en.system;
let queue = [];
let isCalling = false;
let vapiWeb = null;
let timerInterval = null;
let timerSeconds = 0;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function init() {
  restoreLog();
  initCustomAgents();
  renderContacts().catch(console.error);
  renderCRM().catch(console.error);
  initSettingsOnLoad();
  const talkBtn = document.getElementById('btn-talk');
  if (talkBtn) talkBtn.innerHTML = 'üéôÔ∏è &nbsp;Talk to ' + (AGENTS[activeAgent]||{label:'Agent'}).label;
  // Load saved agent edits from localStorage
  const agentEdits = JSON.parse(localStorage.getItem('sofiaAgentEdits') || '{}');
  for (const [agentKey, edits] of Object.entries(agentEdits)) {
    if (AGENTS[agentKey]) {
      AGENTS[agentKey].label = edits.label || AGENTS[agentKey].label;
      const card = document.getElementById(`agent-card-${agentKey}`);
      if (card) {
        const nameEl = card.querySelector('[data-agent="' + agentKey + '"]');
        const descEls = card.querySelectorAll('[data-agent="' + agentKey + '"]');
        if (nameEl) nameEl.textContent = edits.label;
        if (descEls[1]) descEls[1].textContent = edits.desc || descEls[1].textContent;
      }
    }
  }
  
  document.getElementById('custom-opener').value = currentOpener;
  document.getElementById('custom-system').value = currentSystem;
  updateOpenerPreview();
  renderQueue();
  document.getElementById('custom-opener').addEventListener('input', checkModified);
  document.getElementById('custom-system').addEventListener('input', checkModified);
  document.getElementById('phone-number').addEventListener('keydown', e => { if (e.key === 'Enter') callNow(); });
  document.getElementById('contact-name').addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('phone-number').focus(); });
}
document.addEventListener('DOMContentLoaded', init);

// ‚îÄ‚îÄ AGENT SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚îÄ‚îÄ AGENT EDITING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

let editingAgent = null;
let editBackup = {};

function enableAgentEdit(agentKey) {
  if (editingAgent) cancelAgentEdit(editingAgent);
  editingAgent = agentKey;
  
  const card = document.getElementById(`agent-card-${agentKey}`);
  const nameEl = card.querySelector('[data-agent="' + agentKey + '"][contenteditable=false]');
  const descEl = card.querySelectorAll('[data-agent="' + agentKey + '"]')[1];
  
  // Backup original values
  editBackup[agentKey] = {
    name: nameEl.textContent,
    desc: descEl.textContent
  };
  
  // Enable editing
  nameEl.contentEditable = true;
  descEl.contentEditable = true;
  nameEl.focus();
  
  // Add editing class to card
  card.classList.add('editing');
  
  // Select all text
  const range = document.createRange();
  range.selectNodeContents(nameEl);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

function saveAgentEdit(agentKey) {
  const card = document.getElementById(`agent-card-${agentKey}`);
  const nameEl = card.querySelector('[data-agent="' + agentKey + '"][contenteditable=true]');
  const descEl = card.querySelectorAll('[data-agent="' + agentKey + '"][contenteditable=true]')[1];
  
  // Get new values
  const newName = nameEl.textContent.trim();
  const newDesc = descEl.textContent.trim();
  
  // Update AGENTS object
  AGENTS[agentKey].label = newName;
  
  // Save to localStorage
  const agentEdits = JSON.parse(localStorage.getItem('sofiaAgentEdits') || '{}');
  agentEdits[agentKey] = {
    label: newName,
    desc: newDesc
  };
  localStorage.setItem('sofiaAgentEdits', JSON.stringify(agentEdits));
  
  // Update agent card display
  nameEl.contentEditable = false;
  descEl.contentEditable = false;
  card.classList.remove('editing');
  editingAgent = null;
  
  showToast(`${newName} updated ‚úì`, 'success');
}

function cancelAgentEdit(agentKey) {
  const card = document.getElementById(`agent-card-${agentKey}`);
  const nameEl = card.querySelector('[data-agent="' + agentKey + '"][contenteditable=true]');
  const descEl = card.querySelectorAll('[data-agent="' + agentKey + '"][contenteditable=true]')[1];
  
  if (editBackup[agentKey]) {
    nameEl.textContent = editBackup[agentKey].name;
    descEl.textContent = editBackup[agentKey].desc;
  }
  
  nameEl.contentEditable = false;
  descEl.contentEditable = false;
  card.classList.remove('editing');
  editingAgent = null;
}

// Make agent cards editable on double-click
document.addEventListener('dblclick', function(e) {
  const card = e.target.closest('.agent-card');
  if (card) {
    const agentId = card.id.replace('agent-card-', '');
    enableAgentEdit(agentId);
  }
});

function setAgent(agentKey) {
  activeAgent = agentKey;

  // Update card UI
  document.getElementById('agent-card-sofia').className  = 'agent-card' + (agentKey === 'sofia'  ? ' active' : '');
  document.getElementById('agent-card-sofia2').className = 'agent-card' + (agentKey === 'sofia2' ? ' active' : '');
  document.getElementById('agent-card-sofia3').className = 'agent-card' + (agentKey === 'sofia3' ? ' active' : '');
  

  // Load this agent's defaults for current language
  const d = AGENT_DEFAULTS[agentKey][activeLang];
  currentOpener = d.opener;
  currentSystem = d.system;
  document.getElementById('custom-opener').value = currentOpener;
  document.getElementById('custom-system').value = currentSystem;
  updateOpenerPreview();
  checkModified();

  const agent = AGENTS[agentKey];
  showToast(`${agent.emoji} ${agent.label} selected`, 'info');
  const talkBtn = document.getElementById('btn-talk');
  if (talkBtn) talkBtn.innerHTML = 'üéôÔ∏è &nbsp;Talk to ' + agent.label;
  syncSidebar();
  syncSidebarCards();
  updateMainHeader();
}

// ‚îÄ‚îÄ MODE SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setMode(mode) {
  activeMode = mode;
  document.getElementById('tab-browser').className = 'mode-tab' + (mode === 'browser' ? ' active' : '');
  document.getElementById('tab-phone').className   = 'mode-tab' + (mode === 'phone'   ? ' active' : '');
  document.getElementById('browser-section').className = 'browser-section' + (mode === 'browser' ? ' active' : '');
  document.getElementById('phone-section').className   = 'phone-section'   + (mode === 'phone'   ? ' active' : '');
}

// ‚îÄ‚îÄ LANGUAGE SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setLang(lang) {
  activeLang = lang;
  const d = AGENT_DEFAULTS[activeAgent][lang];
  currentOpener = d.opener;
  currentSystem = d.system;
  document.getElementById('lang-en').className = 'lang-btn' + (lang === 'en' ? ' active' : '');
  document.getElementById('lang-el').className = 'lang-btn' + (lang === 'el' ? ' active' : '');
  document.getElementById('custom-opener').value = currentOpener;
  document.getElementById('custom-system').value = currentSystem;
  updateOpenerPreview();
  checkModified();
  showToast(lang === 'el' ? 'üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨' : 'üá∫üá∏ English', 'info');
}

// ‚îÄ‚îÄ CUSTOMIZE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleCustomize() {
  const body  = document.getElementById('customize-body');
  const arrow = document.getElementById('toggle-arrow');
  const btn   = document.getElementById('customize-toggle');
  const open  = body.classList.contains('open');
  body.classList.toggle('open', !open);
  arrow.classList.toggle('open', !open);
  btn.classList.toggle('open', !open);
}
function savePrompt() {
  currentOpener = document.getElementById('custom-opener').value.trim() || DEFAULTS[activeLang].opener;
  currentSystem = document.getElementById('custom-system').value.trim() || DEFAULTS[activeLang].system;
  updateOpenerPreview();
  checkModified();
  toggleCustomize();
  showToast('Agent updated ‚úì', 'success');
}
function resetDefaults() {
  const d = AGENT_DEFAULTS[activeAgent][activeLang];
  document.getElementById('custom-opener').value = d.opener;
  document.getElementById('custom-system').value = d.system;
  currentOpener = d.opener;
  currentSystem = d.system;
  updateOpenerPreview();
  checkModified();
  showToast(activeLang === 'el' ? 'ŒïœÄŒ±ŒΩŒ±œÜŒøœÅŒ¨ œÉœÑŒπœÇ œÄœÅŒøŒµœÄŒπŒªŒøŒ≥Œ≠œÇ' : 'Reset to defaults', 'info');
}
function updateOpenerPreview() {
  document.getElementById('opener-preview-text').textContent = `"${currentOpener}"`;
}
function checkModified() {
  const d = AGENT_DEFAULTS[activeAgent][activeLang];
  const isModified = document.getElementById('custom-opener').value !== d.opener || document.getElementById('custom-system').value !== d.system;
  document.getElementById('modified-badge').className = 'modified-badge' + (isModified ? ' show' : '');
}

// ‚îÄ‚îÄ ASSISTANT PAYLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildAssistantConfig() {
  const isGreek = activeLang === 'el';
  const config = {
    name: "Maria",
    firstMessage: currentOpener,

    model: {
      provider: "openai",
      model: "gpt-4o",
      messages: [{ role: "system", content: getSystemWithKnowledge() }],
      temperature: activeAgent === 'sofia3' ? 0.9 : 0.7
    },
    voice: (() => {
      const voiceMap = {
        sofia_en: "21m00Tcm4TlvDq8ikWAM",
        sofia_el: "21m00Tcm4TlvDq8ikWAM",
        sofia2_en: "21m00Tcm4TlvDq8ikWAM",
        sofia2_el: "21m00Tcm4TlvDq8ikWAM",
        sofia3_en: "21m00Tcm4TlvDq8ikWAM",  // Same as Sofia 1 - proven natural voice
        sofia3_el: "21m00Tcm4TlvDq8ikWAM"   // Same as Sofia 1 - same voice for Greek (EL11labs supports multilingual)
      };
      const key = `${activeAgent}_${activeLang}`;
      const isSofia3 = activeAgent === 'sofia3';
      const baseVoice = {
        provider: "11labs",
        voiceId: voiceMap[key] || "21m00Tcm4TlvDq8ikWAM",
        model: "eleven_turbo_v2_5",
        stability: 0.65,
        similarityBoost: 0.75
      };
      if (isSofia3) {
        baseVoice.stability = 0.35;
        baseVoice.similarityBoost = 0.75;
      }
      return baseVoice;
    })(),
    transcriber: AGENT_DEFAULTS[activeAgent][activeLang].transcriber
  };
  
  // Add endCall config only for non-Sofia3 agents
  if (activeAgent !== 'sofia3') {
    config.endCallMessage = isGreek
      ? "ŒßŒ±œÅŒøœçŒºŒµŒΩŒ∑ œÄŒøœÖ ŒºŒπŒªŒÆœÉŒ±ŒºŒµ. ŒòŒ± ŒµœÄŒπŒ∫ŒøŒπŒΩœâŒΩŒÆœÉœâ œÉœçŒΩœÑŒøŒºŒ±. ŒöŒ±ŒªŒÆ œÉœÖŒΩŒ≠œáŒµŒπŒ±!"
      : "Great speaking with you. I will follow up shortly. Have a great day!";
    config.endCallPhrases = isGreek
      ? ["goodbye", "bye", "not interested", "remove me"]
      : ["goodbye", "bye", "not interested", "remove me"];
  }
  
  if (activeAgent === 'sofia3') {
    config.backchannelingEnabled = true;
    config.silenceTimeoutSeconds = 20;
    config.responseDelaySeconds = 0.5;
  }

  return config;
}

// ‚îÄ‚îÄ BROWSER CALL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setBrowserStatus(text, active = false) {
  const el = document.getElementById('call-status');
  el.textContent = text;
  el.className = 'call-status' + (active ? ' active' : '');
}
function setWave(on) {
  document.getElementById('wave').className = 'wave-wrap' + (on ? ' visible' : '');
  for (let i = 1; i <= 7; i++) {
    const b = document.getElementById(`wb${i}`);
    if (on) b.classList.remove('idle'); else b.classList.add('idle');
  }
}
function startCallTimer() {
  timerSeconds = 0;
  timerInterval = setInterval(() => {
    timerSeconds++;
    const m = String(Math.floor(timerSeconds / 60)).padStart(2,'0');
    const s = String(timerSeconds % 60).padStart(2,'0');
    document.getElementById('call-timer').textContent = `${m}:${s}`;
  }, 1000);
  document.getElementById('call-timer').className = 'call-timer visible';
}
function stopCallTimer() {
  clearInterval(timerInterval);
  document.getElementById('call-timer').className = 'call-timer';
}

async function startBrowserCall() {
  const btn = document.getElementById('btn-talk');
  btn.disabled = true;
  setBrowserStatus('Connecting...');

  if (!window.Vapi) {
    setBrowserStatus('Loading SDK...');
    await new Promise((res, rej) => {
      const t = setTimeout(() => rej(new Error('SDK timeout')), 12000);
      document.addEventListener('vapi-sdk-ready', () => { clearTimeout(t); res(); }, { once: true });
    }).catch(e => {
      showToast('Failed to load. Refresh the page.', 'error');
      btn.disabled = false;
      setBrowserStatus('Available now');
      return;
    });
    if (!window.Vapi) return;
  }

  try {
    vapiWeb = new window.Vapi(PUBLIC_KEY);

    vapiWeb.on('call-start', () => {
      setBrowserStatus(activeLang === 'el' ? 'ŒúŒπŒªŒ¨ŒµŒπ...' : 'Speaking...', true);
      btn.style.display = 'none';
      document.getElementById('btn-end-call').classList.add('show');
      document.getElementById('dot').className = 'online-dot busy';
      document.getElementById('avatar').classList.add('speaking');
      setWave(true);
      startCallTimer();
      addLog('Browser call started', 'var(--accent2)');
    });
    vapiWeb.on('speech-start', () => {
      setBrowserStatus(activeLang === 'el' ? 'ŒúŒπŒªŒ¨ŒµŒπ...' : 'Speaking...', true);
      setWave(true);
      document.getElementById('avatar').classList.add('speaking');
    });
    vapiWeb.on('speech-end', () => {
      setBrowserStatus(activeLang === 'el' ? 'ŒëŒ∫ŒøœçŒµŒπ...' : 'Listening...', true);
      setWave(false);
      document.getElementById('avatar').classList.remove('speaking');
    });
    vapiWeb.on('call-end', () => {
      stopCallTimer();
      setWave(false);
      document.getElementById('avatar').classList.remove('speaking');
      document.getElementById('btn-end-call').classList.remove('show');
      btn.style.display = 'flex';
      btn.disabled = false;
      btn.innerHTML = activeLang === 'el' ? 'üîÑ &nbsp;ŒùŒ≠Œ± Œ∫ŒªŒÆœÉŒ∑' : 'üîÑ &nbsp;Call Again';
      document.getElementById('dot').className = 'online-dot';
      setBrowserStatus(activeLang === 'el' ? 'Œó Œ∫ŒªŒÆœÉŒ∑ œÑŒµŒªŒµŒØœâœÉŒµ' : 'Call ended');
      setTimeout(() => setBrowserStatus(activeLang === 'el' ? 'ŒîŒπŒ±Œ∏Œ≠œÉŒπŒºŒ∑' : 'Available now'), 3000);
      addLog('Browser call ended', 'var(--gray)');
      showOutcomeModal('Browser call', null);
    });
    vapiWeb.on('error', e => {
      showToast(e.message || 'Something went wrong', 'error');
      btn.disabled = false;
      setBrowserStatus(activeLang === 'el' ? 'ŒîŒπŒ±Œ∏Œ≠œÉŒπŒºŒ∑' : 'Available now');
    });

    await vapiWeb.start(buildAssistantConfig());

  } catch(e) {
    showToast(e.message || 'Failed to start call', 'error');
    btn.disabled = false;
    setBrowserStatus(activeLang === 'el' ? 'ŒîŒπŒ±Œ∏Œ≠œÉŒπŒºŒ∑' : 'Available now');
  }
}

function endBrowserCall() {
  if (vapiWeb) vapiWeb.stop();
}

// ‚îÄ‚îÄ VAPI PHONE API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function makePhoneCall(number) {
  const res = await fetch('https://api.vapi.ai/call/phone', {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${PRIVATE_KEY}`, 'Content-Type': 'application/json' },
    body: JSON.stringify({ phoneNumberId: PHONE_NUMBER_ID, customer: { number }, assistant: buildAssistantConfig() })
  });
  const data = await res.json();
  if (!res.ok) throw new Error(data.message || 'Call failed');
  return data;
}

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg, type = 'info') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.classList.remove('show'), 3500);
}
function getFullNumber() {
  const cc  = document.getElementById('country-code').value;
  const num = document.getElementById('phone-number').value.replace(/\s+/g,'').replace(/^0/,'');
  return cc + num;
}
function getInput() {
  const number = getFullNumber();
  const name   = document.getElementById('contact-name').value.trim() || number;
  return { number, name };
}
function clearInput() {
  document.getElementById('phone-number').value = '';
  document.getElementById('contact-name').value = '';
  document.getElementById('phone-number').focus();
}
function addLog(msg, color = '#6c6c84') {
  const empty = document.getElementById('log-empty');
  if (empty) empty.remove();
  const now = new Date().toLocaleTimeString('el-GR', { hour: '2-digit', minute: '2-digit' });
  const item = document.createElement('div');
  item.className = 'log-item';
  item.innerHTML = `<div class="dot" style="background:${color}"></div><span>${msg}</span><span class="log-time">${now}</span>`;
  document.getElementById('log-list').prepend(item);
  // Persist to localStorage (keep last 50)
  const logs = JSON.parse(localStorage.getItem('sofiaActivityLog') || '[]');
  logs.unshift({ msg, color, time: now });
  if (logs.length > 50) logs.pop();
  localStorage.setItem('sofiaActivityLog', JSON.stringify(logs));
}

function restoreLog() {
  const logs = JSON.parse(localStorage.getItem('sofiaActivityLog') || '[]');
  if (!logs.length) return;
  const list = document.getElementById('log-list');
  const empty = document.getElementById('log-empty');
  if (empty) empty.remove();
  logs.forEach(({ msg, color, time }) => {
    const item = document.createElement('div');
    item.className = 'log-item';
    item.innerHTML = `<div class="dot" style="background:${color}"></div><span>${msg}</span><span class="log-time">${time}</span>`;
    list.appendChild(item);
  });
}

// ‚îÄ‚îÄ QUEUE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderQueue() {
  const list    = document.getElementById('queue-list');
  const empty   = document.getElementById('queue-empty');
  const count   = document.getElementById('queue-count');
  const callAll = document.getElementById('btn-call-all');
  count.textContent = queue.length;
  callAll.disabled  = queue.length === 0 || isCalling;
  if (queue.length === 0) { empty.style.display = 'block'; list.innerHTML = ''; return; }
  empty.style.display = 'none';
  list.innerHTML = queue.map(item => `
    <div class="queue-item ${item.status}" id="qi-${item.id}">
      <div class="item-avatar">üë§</div>
      <div class="item-info">
        <div class="item-name">${item.name}</div>
        <div class="item-number">${item.number}</div>
      </div>
      <div class="item-status status-${item.status}">${statusLabel(item.status)}</div>
      <div class="item-actions">
        <button class="btn-icon" onclick="callSingle('${item.id}')" title="Call" ${isCalling ? 'disabled' : ''}>üìû</button>
        <button class="btn-icon danger" onclick="removeItem('${item.id}')" title="Remove" ${item.status === 'calling' ? 'disabled' : ''}>‚úï</button>
      </div>
    </div>`).join('');
}
function statusLabel(s) { return { pending:'Pending', calling:'Calling...', done:'Called', failed:'Failed' }[s] || s; }
function addToQueue() {
  const { number, name } = getInput();
  if (number.length < 8) { showToast('Enter a valid phone number', 'error'); return; }
  queue.push({ id: Date.now().toString(), number, name, status: 'pending' });
  renderQueue(); clearInput();
  showToast(`${name} added to list`, 'success');
}
function removeItem(id) { queue = queue.filter(i => i.id !== id); renderQueue(); }

// ‚îÄ‚îÄ CALL NOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function callNow() {
  const { number, name } = getInput();
  if (number.length < 8) { showToast('Enter a valid phone number', 'error'); return; }
  const btn = document.getElementById('btn-call-now');
  btn.disabled = true; btn.textContent = '‚è≥ Dialing...';
  try {
    const callData = await makePhoneCall(number);
    showToast(`üìû Sofia is calling ${name}`, 'success');
    addLog(`Call initiated ‚Üí ${name} (${number})`, 'var(--accent2)');
    clearInput();
    setTimeout(() => showOutcomeModal(name, callData ? callData.id : null), 8000);
  } catch(e) {
    showToast(e.message, 'error');
    addLog(`Failed ‚Üí ${name}: ${e.message}`, 'var(--red)');
  }
  btn.disabled = false; btn.innerHTML = 'üìû Call Now';
}

// ‚îÄ‚îÄ CALL SINGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function callSingle(id) {
  const item = queue.find(i => i.id === id);
  if (!item) return;
  item.status = 'calling'; isCalling = true; renderQueue();
  try {
    await makePhoneCall(item.number);
    item.status = 'done';
    showToast(`üìû Sofia called ${item.name}`, 'success');
    addLog(`Call sent ‚Üí ${item.name} (${item.number})`, 'var(--green)');
  } catch(e) {
    item.status = 'failed';
    showToast(`Failed: ${e.message}`, 'error');
    addLog(`Failed ‚Üí ${item.name}: ${e.message}`, 'var(--red)');
  }
  isCalling = false; renderQueue();
}

// ‚îÄ‚îÄ CALL ALL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function callAll() {
  const pending = queue.filter(i => i.status === 'pending');
  if (!pending.length) { showToast('No pending numbers', 'info'); return; }
  isCalling = true; renderQueue();
  addLog(`Starting batch: ${pending.length} calls`, 'var(--accent2)');
  for (let i = 0; i < pending.length; i++) {
    const item = pending[i];
    item.status = 'calling'; renderQueue();
    try {
      await makePhoneCall(item.number);
      item.status = 'done';
      addLog(`‚úì Called ${item.name} (${item.number})`, 'var(--green)');
    } catch(e) {
      item.status = 'failed';
      addLog(`‚úó Failed ${item.name}: ${e.message}`, 'var(--red)');
    }
    renderQueue();
    if (i < pending.length - 1) await new Promise(r => setTimeout(r, 1500));
  }
  isCalling = false; renderQueue();
  showToast(`Batch complete: ${pending.length} calls sent`, 'success');
  addLog('Batch complete', 'var(--accent2)');
}

// ‚îÄ‚îÄ Expose all functions to global scope (required for inline onclick in HTML) ‚îÄ‚îÄ
window.addToCRM         = addToCRM;
window.removeCRMLead    = removeCRMLead;
window.saveCRMNote      = saveCRMNote;
window.exportCRM        = exportCRM;
window.addContact       = addContact;
window.deleteContact    = deleteContact;
window.callContact      = callContact;
window.queueContact     = queueContact;
window.queueAllContacts = queueAllContacts;
window.importCSV        = importCSV;
window.openAgentModal   = openAgentModal;
window.closeAgentModal  = closeAgentModal;
window.saveNewAgent     = saveNewAgent;
window.switchModalLang  = switchModalLang;
window.deleteCustomAgent = deleteCustomAgent;
window.setAgent         = setAgent;
window.setLang          = setLang;
window.setMode          = setMode;
window.callNow          = callNow;
window.callSingle       = callSingle;
window.callAll          = callAll;
window.addToQueue       = addToQueue;
window.removeItem       = removeItem;
window.startBrowserCall = startBrowserCall;
window.endBrowserCall   = endBrowserCall;

// ‚ïê‚ïê‚ïê‚ïê AGENT SIMULATION TESTING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚ïê‚ïê‚ïê‚ïê AGENT SIMULATION TESTING (FULLY AUTOMATED) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

var simMuted = false;
var simVoices = { agent: null, customer: null };

function toggleSimMute() {
  simMuted = !simMuted;
  var btn = document.getElementById('sim-mute-btn');
  if (btn) btn.textContent = simMuted ? 'üîá Sound OFF' : 'üîä Sound ON';
  if (simMuted) window.speechSynthesis.cancel();
}

var EL_API_KEY = '12cb98753027013e75c93813effeaac5';
var simAudioCtx = null;

function getSimAudioCtx() {
  if (!simAudioCtx || simAudioCtx.state === 'closed') {
    simAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  if (simAudioCtx.state === 'suspended') simAudioCtx.resume();
  return simAudioCtx;
}

// Load browser voices for customer side
function loadSimVoices() {
  var voices = window.speechSynthesis.getVoices();
  if (!voices.length) return;
  var custPref = ['Daniel', 'Alex', 'Google UK English Male', 'Tom', 'Fred', 'Google US English'];
  for (var j = 0; j < custPref.length; j++) {
    var cv = voices.find(function(x) { return x.name.indexOf(custPref[j]) !== -1; });
    if (cv) { simVoices.customer = cv; break; }
  }
  if (!simVoices.customer) simVoices.customer = voices[0];
}
if (window.speechSynthesis) {
  loadSimVoices();
  window.speechSynthesis.onvoiceschanged = loadSimVoices;
}

// Speak agent line via ElevenLabs TTS (actual agent voice)
function speakAgentElevenLabs(text) {
  return new Promise(function(resolve) {
    if (simMuted) return resolve();
    var cfg = buildAssistantConfig();
    var voiceId = '21m00Tcm4TlvDq8ikWAM'; // default Sofia 3
    var stability = 0.55;
    var speed = 0.7;
    if (cfg.voice && cfg.voice.voiceId) voiceId = cfg.voice.voiceId;
    if (cfg.voice && cfg.voice.stability) stability = cfg.voice.stability;
    if (cfg.voice && cfg.voice.speed) speed = cfg.voice.speed;

    var modelId = (cfg.voice && cfg.voice.model) ? cfg.voice.model : ((activeLang === 'el') ? 'eleven_turbo_v2_5' : 'eleven_multilingual_v2');

    if (!speed || speed < 0.7) speed = 1.0; // default if agent has no speed set
    var voiceSettings = { stability: stability, similarity_boost: 0.75, speed: speed };

    var ctx = getSimAudioCtx();

    fetch('https://api.elevenlabs.io/v1/text-to-speech/' + voiceId, {
      method: 'POST',
      headers: {
        'xi-api-key': EL_API_KEY,
        'Content-Type': 'application/json',
        'Accept': 'audio/mpeg'
      },
      body: JSON.stringify({
        text: text,
        model_id: modelId,
        voice_settings: voiceSettings
      })
    })
    .then(function(res) {
      if (!res.ok) return res.text().then(function(t) { throw new Error('EL ' + res.status + ': ' + t); });
      return res.arrayBuffer();
    })
    .then(function(buffer) {
      return ctx.decodeAudioData(buffer);
    })
    .then(function(audioBuffer) {
      var source = ctx.createBufferSource();
      source.buffer = audioBuffer;
      source.connect(ctx.destination);
      source.onended = resolve;
      source.start(0);
    })
    .catch(function(e) {
      console.warn('ElevenLabs TTS error:', e.message);
      appendSimLine(null, '‚ö†Ô∏è EL error: ' + e.message, true);
      speakBrowser(text, 'AI').then(resolve);
    });
  });
}

// Browser TTS fallback / customer voice
function speakBrowser(text, role) {
  return new Promise(function(resolve) {
    if (!window.speechSynthesis) return resolve();
    window.speechSynthesis.cancel();
    var utter = new SpeechSynthesisUtterance(text);
    if (role === 'User' && simVoices.customer) utter.voice = simVoices.customer;
    utter.pitch = 0.85;
    utter.rate = 0.95;
    utter.onend = resolve;
    utter.onerror = resolve;
    window.speechSynthesis.speak(utter);
  });
}

function speakSimLine(text, role) {
  if (simMuted) return Promise.resolve();
  if (role === 'AI') return speakAgentElevenLabs(text);
  return speakBrowser(text, 'User');
}

window.toggleSimMute = toggleSimMute;

var SIM_SCENARIOS = [
  {
    name: 'Interested Buyer',
    emoji: 'üòä',
    persona: 'You are a curious potential customer who received a cold call. You are open and friendly. Ask what the company sells, show mild interest, ask how it works, and eventually agree to hear more or schedule a follow-up. Keep replies short (1-2 sentences max). Do not reveal you are AI.',
    turns: [
      'Hello?',
      'Oh hi ‚Äî who is this?',
      'ŒúŒôŒë Collection? What is that exactly?',
      'Interesting ‚Äî European brands? Like what kind of clothes?',
      'And how does it work, do I order online or visit a store?',
      'Okay, that sounds interesting. What would be the next step?',
      'Alright, sure. I can take a look.'
    ]
  },
  {
    name: 'The Objector',
    emoji: 'ü§î',
    persona: 'You are a skeptical customer on a cold call. You are polite but reluctant. Say you already have a place you shop, say you need to think about it, ask "why should I switch?", say you are busy. Let the agent try to win you over. Keep replies short.',
    turns: [
      'Yes, hello?',
      'I already have brands I buy from, I\'m not really looking for anything new.',
      'I don\'t know... I need to think about it.',
      'Why should I choose you over what I already use?',
      'I\'m quite busy these days.',
      'Maybe some other time.',
      'Fine, you can send me some information.'
    ]
  },
  {
    name: 'Price Shopper',
    emoji: 'üí∂',
    persona: 'You are a customer focused entirely on price and deals. Ask "how much does it cost?" immediately. Ask about discounts, free shipping, and how it compares to cheaper options. Be direct and deal-focused. Keep replies short.',
    turns: [
      'Hi, how much does it cost?',
      'Is there a minimum order or anything like that?',
      'Do you have any discounts or promotions?',
      'What about shipping, is it free?',
      'How does that compare to other stores?',
      'Okay and what\'s the return policy?',
      'Alright, let me think about it.'
    ]
  },
  {
    name: 'Wrong Number / Hostile',
    emoji: 'üìµ',
    persona: 'You are an annoyed person who did not ask to be called. Start hostile ‚Äî "who gave you my number?", "I\'m not interested", "stop calling me". If the agent is very polite and professional, gradually soften slightly by the end. Keep replies short and sharp.',
    turns: [
      'Who is this? I didn\'t ask for any call.',
      'I\'m not interested. Please don\'t call me.',
      'How did you even get my number?',
      'I said I\'m NOT interested.',
      'This is harassment. I\'m going to report this.',
      'Fine ‚Äî what exactly are you selling? Make it quick.',
      'Okay. Whatever. Don\'t call again.'
    ]
  }
];

var activeScenarioIdx = 0;
var simRunning = false;
var simTranscriptLines = [];

// VAPI /chat history (array of {role, content} objects)
var simChatHistory = [];

function openSimModal() {
  document.getElementById('sim-modal').classList.add('open');
  resetSim();
}

function closeSimModal() {
  simRunning = false;
  if (window.speechSynthesis) window.speechSynthesis.cancel();
  document.getElementById('sim-modal').classList.remove('open');
}

function selectScenario(idx) {
  activeScenarioIdx = idx;
  document.querySelectorAll('.scenario-card').forEach(function(c) { c.classList.remove('active'); });
  var target = document.querySelector('.scenario-card[data-idx="' + idx + '"]');
  if (target) target.classList.add('active');
  var tip = document.getElementById('sim-scenario-tip');
  if (tip) tip.innerHTML = '<strong>Scenario:</strong> ' + SIM_SCENARIOS[idx].persona.split('.')[0] + '.';
}

function resetSim() {
  simRunning = false;
  if (window.speechSynthesis) window.speechSynthesis.cancel();
  simTranscriptLines = [];
  simChatHistory = [];
  var tx = document.getElementById('sim-transcript');
  tx.innerHTML = '<div style="color:#555;font-size:12px;text-align:center;padding:20px 0;">Conversation will appear here automatically...</div>';
  tx.classList.remove('visible');
  document.getElementById('sim-score-card').classList.remove('visible');
  var btn = document.getElementById('sim-start-btn');
  btn.disabled = false;
  btn.textContent = '‚ñ∂ Run Auto-Simulation';
  selectScenario(activeScenarioIdx);
}

function appendSimLine(role, text, isSystem) {
  var tx = document.getElementById('sim-transcript');
  tx.classList.add('visible');
  var line = document.createElement('div');
  if (isSystem) {
    line.style.cssText = 'color:#444;font-size:11px;text-align:center;margin:8px 0;font-style:italic;';
    line.textContent = text;
  } else {
    line.className = 'sim-tx-line ' + (role === 'AI' ? 'ai' : 'user');
    var label = role === 'AI' ? (AGENTS[activeAgent] || {label:'Agent'}).label : 'Customer';
    line.innerHTML = '<span class="sim-tx-label">' + label + '</span>' + text;
  }
  tx.appendChild(line);
  tx.scrollTop = tx.scrollHeight;
  if (!isSystem) simTranscriptLines.push({ role: role, text: text });
}

function showTypingIndicator(role) {
  var tx = document.getElementById('sim-transcript');
  tx.classList.add('visible');
  var el = document.createElement('div');
  el.id = 'sim-typing';
  el.className = 'sim-tx-line ' + (role === 'AI' ? 'ai' : 'user');
  el.style.opacity = '0.6';
  el.innerHTML = '<span class="sim-tx-label">' + (role === 'AI' ? (AGENTS[activeAgent]||{label:'Agent'}).label : 'Customer') + '</span><em>typing...</em>';
  tx.appendChild(el);
  tx.scrollTop = tx.scrollHeight;
}

function removeTypingIndicator() {
  var el = document.getElementById('sim-typing');
  if (el) el.remove();
}

async function vapiChat(messages) {
  var cfg = buildAssistantConfig();
  var systemMsg = '';
  if (cfg.model && cfg.model.messages && cfg.model.messages.length > 0) {
    systemMsg = cfg.model.messages[0].content;
  }
  systemMsg += '\n\n[SIMULATION MODE ‚Äî internal test. Behave exactly as in a real sales call. Be concise ‚Äî 1-3 sentences per reply.]';

  var payload = {
    assistant: {
      model: {
        provider: cfg.model ? cfg.model.provider : 'openai',
        model: cfg.model ? cfg.model.model : 'gpt-4o-mini',
        messages: [{ role: 'system', content: systemMsg }]
      }
    },
    input: messages
  };

  var res = await fetch('https://api.vapi.ai/chat', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + PRIVATE_KEY, 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });
  var data = await res.json();
  if (!res.ok) throw new Error(data.message || 'VAPI chat error');
  var output = data.output || [];
  var assistantMsg = '';
  for (var i = 0; i < output.length; i++) {
    if (output[i].role === 'assistant') { assistantMsg = output[i].content; break; }
  }
  return assistantMsg;
}

function sleep(ms) { return new Promise(function(r) { setTimeout(r, ms); }); }

async function startSimCall() {
  // Unlock AudioContext on user gesture
  getSimAudioCtx();

  var scenario = SIM_SCENARIOS[activeScenarioIdx];
  var btn = document.getElementById('sim-start-btn');
  btn.disabled = true;
  btn.textContent = '‚è≥ Running simulation...';

  var tx = document.getElementById('sim-transcript');
  tx.innerHTML = '';
  tx.classList.add('visible');
  simTranscriptLines = [];
  simChatHistory = [];
  simRunning = true;

  appendSimLine(null, '‚Äî Simulation started: ' + scenario.name + ' ‚Äî', true);
  addLog('Auto-simulation started (' + scenario.name + ')', '#7c3aed');

  try {
    for (var t = 0; t < scenario.turns.length; t++) {
      if (!simRunning) break;

      var customerLine = scenario.turns[t];

      // Show customer typing then speak
      await sleep(400);
      showTypingIndicator('User');
      await sleep(500 + customerLine.length * 10);
      removeTypingIndicator();
      appendSimLine('User', customerLine);
      await speakSimLine(customerLine, 'User');

      // Add to history
      simChatHistory.push({ role: 'user', content: customerLine });

      // Get agent response
      await sleep(300);
      showTypingIndicator('AI');
      var agentReply = await vapiChat(simChatHistory.slice());
      removeTypingIndicator();

      if (!agentReply) agentReply = '[No response]';
      appendSimLine('AI', agentReply);
      simChatHistory.push({ role: 'assistant', content: agentReply });
      await speakSimLine(agentReply, 'AI');

      // Natural pause between turns
      await sleep(500);
    }

    if (simRunning) {
      appendSimLine(null, '‚Äî Simulation complete ‚Äî', true);
      btn.textContent = '‚úÖ Done';
      addLog('Auto-simulation complete', '#888');
      await sleep(400);
      showSimScore();
    }

  } catch(e) {
    removeTypingIndicator();
    appendSimLine(null, '‚Äî Error: ' + (e.message || 'Unknown error') + ' ‚Äî', true);
    showToast('Simulation error: ' + (e.message || 'check console'), 'error');
    btn.disabled = false;
    btn.textContent = '‚ñ∂ Run Auto-Simulation';
    simRunning = false;
  }
}

function scoreSimulation(lines) {
  var aiLines = lines.filter(function(l) { return l.role === 'AI'; });
  var fullText = lines.map(function(l) { return l.text.toLowerCase(); }).join(' ');
  var aiText = aiLines.map(function(l) { return l.text.toLowerCase(); }).join(' ');
  return [
    {
      label: 'Introduced itself by name',
      pass: /sofia|maria|elena|Œ≥ŒµŒπŒ±|hello|speaking|this is|i am|i\'m/.test(aiText)
    },
    {
      label: 'Mentioned ŒúŒôŒë Collection brand',
      pass: /ŒºŒπŒ±|mia|collection/.test(aiText)
    },
    {
      label: 'Explained what the brand offers',
      pass: /fashion|œÅŒøœçœáŒ±|clothes|Œ≥œÖŒΩŒ±ŒπŒ∫ŒµŒØŒ±|european|brands|style|œÉœÑœÖŒª|collection|wear/.test(aiText)
    },
    {
      label: 'Gave substantive replies (not one-liners)',
      pass: aiLines.filter(function(l) { return l.text.split(' ').length > 10; }).length >= 3
    },
    {
      label: 'Guided towards a next step',
      pass: /interested|appointment|œÅŒ±ŒΩœÑŒµŒ≤Œøœç|schedule|book|send|website|follow|œÄœåœÑŒµ|when|learn more/.test(aiText)
    },
    {
      label: 'Handled pushback professionally',
      pass: !/sorry|apologize/.test(aiText) || aiLines.length >= 4
    }
  ];
}

function showSimScore() {
  var checks = scoreSimulation(simTranscriptLines);
  var passed = checks.filter(function(c) { return c.pass; }).length;
  var pct = Math.round((passed / checks.length) * 100);
  var grade = pct >= 90 ? 'üèÜ Excellent' : pct >= 70 ? '‚úÖ Good' : pct >= 50 ? '‚ö†Ô∏è Needs Work' : '‚ùå Poor';
  var color = pct >= 90 ? '#22c55e' : pct >= 70 ? '#7c3aed' : pct >= 50 ? '#f59e0b' : '#ef4444';

  document.getElementById('sim-score-rows').innerHTML = checks.map(function(c) {
    return '<div class="sim-score-row"><span class="si">' + (c.pass ? '‚úÖ' : '‚ùå') + '</span><span>' + c.label + '</span></div>';
  }).join('');

  document.getElementById('sim-score-grade').textContent = grade;
  document.getElementById('sim-score-pct').textContent = pct + '%';
  var fill = document.getElementById('sim-score-fill');
  fill.style.width = '0%';
  fill.style.background = color;
  setTimeout(function() { fill.style.width = pct + '%'; }, 50);
  document.getElementById('sim-score-card').classList.add('visible');
}

window.openSimModal    = openSimModal;
window.closeSimModal   = closeSimModal;
window.selectScenario  = selectScenario;
window.startSimCall    = startSimCall;
window.resetSim        = resetSim;
window.savePrompt       = savePrompt;
window.resetDefaults    = resetDefaults;


// ‚ïê‚ïê‚ïê‚ïê KNOWLEDGE FILES HELPERS ‚ïê‚ïê‚ïê‚ïê
function getSystemWithKnowledge() {
  const files = loadKF();
  if (!files.length) return currentSystem;
  return currentSystem + '\n\n[Knowledge Base]\n' + files.map(f => f.name+':\n'+f.content).join('\n\n');
}
function getSystemWithKF() { return getSystemWithKnowledge(); }

// ‚ïê‚ïê‚ïê‚ïê RECENT CALLS ‚ïê‚ïê‚ïê‚ïê
async function loadRecentCalls() {
  const el = document.getElementById('calls-list');
  const btn = document.getElementById('calls-refresh-btn');
  el.innerHTML = '<div class="log-empty">Loading...</div>';
  const labelEl = document.getElementById('calls-agent-label');
  if (labelEl) labelEl.textContent = (AGENTS[activeAgent] || {}).label || activeAgent;
  btn.textContent = '‚è≥';
  btn.disabled = true;
  try {
    const res = await fetch('https://api.vapi.ai/call?limit=20', {
      headers: { Authorization: 'Bearer ' + PRIVATE_KEY }
    });
    const raw = await res.text();
    console.log('VAPI calls raw:', raw.substring(0, 300));
    let data;
    try { data = JSON.parse(raw); } catch(pe) { el.innerHTML = '<div class="log-empty" style="color:var(--red)">Parse error: ' + pe.message + '<br>' + raw.substring(0,100) + '</div>'; return; }
    console.log('VAPI calls type:', typeof data, Array.isArray(data), data && data.length);
    let calls = Array.isArray(data) ? data : (data.results || data.calls || []);
    if (!calls.length) { el.innerHTML = '<div class="log-empty">No calls found ‚Äî check console for raw response</div>'; return; }

    // Filter by active agent using transcript keywords
    const agentKeywords = {
      sofia:  ['Maria', 'Growth-onomics', 'Growthonomics', 'growtho'],
      sofia2: ['Elena', 'AI Marketing', 'AI marketing'],
      sofia3: ['MIA Collection', 'ŒúŒôŒë Collection', 'Mia Collection', 'Miya'],
    };
    // Phone calls only
    calls = calls.filter(c => c.type === 'outboundPhoneCall' || c.type === 'inboundPhoneCall');
    if (!calls.length) { el.innerHTML = '<div class="log-empty">No phone calls found</div>'; return; }

    const keywords = agentKeywords[activeAgent];
    if (keywords) {
      const filtered = calls.filter(c => {
        const text = (c.transcript || '') + (c.summary || '');
        return keywords.some(k => text.toLowerCase().includes(k.toLowerCase()));
      });
      calls = filtered.length ? filtered : calls;
      if (!filtered.length) el.innerHTML = '<div class="log-empty" style="color:var(--yellow)">No phone calls found for this agent ‚Äî showing all</div>';
    }
    el.innerHTML = calls.map((c, i) => {
      const status = c.status || 'unknown';
      const statusClass = status === 'ended' ? 'ended' : status.includes('fail') || status.includes('error') ? 'failed' : 'other';
      const number = (c.customer && c.customer.number) || (c.type === 'webCall' ? 'Browser call' : 'Unknown');
      const started = c.startedAt ? new Date(c.startedAt).toLocaleString() : (c.createdAt ? new Date(c.createdAt).toLocaleString() : '‚Äî');
      const secs = (c.startedAt && c.endedAt) ? Math.round((new Date(c.endedAt) - new Date(c.startedAt)) / 1000) : null;
      const dur = secs != null ? (secs >= 60 ? Math.floor(secs/60) + 'm ' + (secs%60) + 's' : secs + 's') : '‚Äî';
      const recording = c.recordingUrl || (c.artifact && c.artifact.recordingUrl) || (c.stereoRecordingUrl) || null;
      const transcript = c.transcript || (c.artifact && c.artifact.transcript) || null;
      const summary = c.summary || (c.artifact && c.artifact.summary) || null;
      const score = scoreCall(transcript, summary);
      const crmLead = { callId: c.id, name: number, number: number, agent: (AGENTS[activeAgent]||{}).label||activeAgent, date: started, summary, recording, scoreLabel: score.label, scoreCls: score.cls, notes: '' };
      // Auto-add Hot & Warm calls to CRM silently
      if (score.rank >= 1) {
        sbInsert('dialer_crm', {
          call_id: crmLead.callId, name: crmLead.name, number: crmLead.number,
          agent: crmLead.agent, score_label: crmLead.scoreLabel, score_cls: crmLead.scoreCls,
          summary: crmLead.summary, recording_url: crmLead.recording,
          notes: '', called_at: crmLead.date
        }).then(() => renderCRM()).catch(()=>{});
      }
      return `<div class="call-item">
        <div class="call-row">
          <span class="call-status ${statusClass}">${status}</span>
          <span class="call-number">${number}</span>
          <span class="call-duration">${dur}</span>
          <span class="score-badge score-${score.cls}">${score.label}</span>
        </div>
        <div class="call-time">${started}</div>
        ${recording ? `<audio class="call-audio" controls src="${recording}"></audio>` : '<div style="font-size:11px;color:var(--gray)">No recording available</div>'}
        ${(transcript || summary) ? `<button class="call-transcript-btn" onclick="toggleTranscript(${i})">üí¨ Show conversation</button><div class="call-transcript" id="transcript-${i}">${summary ? '<div class="ct-summary"><strong>üìã Summary</strong><p>' + summary + '</p></div>' : ''}${transcript ? '<div class="ct-convo">' + formatTranscript(transcript) + '</div>' : ''}</div>` : ''}
        ${score.rank >= 1 ? `<div style="margin-top:6px;font-size:11px;color:#059669;font-weight:600">‚úÖ Auto-added to CRM</div>` : ''}
      </div>`;
    }).join('');
  } catch(e) {
    el.innerHTML = '<div class="log-empty" style="color:var(--red)">Error loading calls: ' + e.message + '</div>';
  } finally {
    btn.textContent = '‚Üª Refresh';
    btn.disabled = false;
  }
}

function formatTranscript(text) {
  // Split on "AI:" or "User:" markers
  const lines = text.split(/(?=\b(?:AI|User|Sofia|Assistant):\s)/i).filter(l => l.trim());
  return lines.map(line => {
    const isAI = /^(AI|Sofia|Assistant):/i.test(line.trim());
    const speaker = isAI ? 'Sofia' : 'Customer';
    const content = line.replace(/^(AI|User|Sofia|Assistant):\s*/i, '').trim();
    if (!content) return '';
    return `<div class="ct-line ${isAI ? 'ai' : 'user'}">
      <div class="ct-speaker">${speaker}</div>
      <div class="ct-bubble">${content}</div>
    </div>`;
  }).join('');
}

function toggleTranscript(i) {
  const el = document.getElementById('transcript-' + i);
  if (!el) return;
  const visible = el.style.display === 'block';
  el.style.display = visible ? 'none' : 'block';
  el.previousElementSibling.textContent = visible ? 'üìÑ Show transcript' : 'üìÑ Hide transcript';
}

// ‚ïê‚ïê‚ïê‚ïê CALL SCORING & CRM ‚ïê‚ïê‚ïê‚ïê
function scoreCall(transcript, summary) {
  const text = ((transcript || '') + ' ' + (summary || '')).toLowerCase();
  const hot  = ['demo', 'send email', 'send info', 'more information', 'schedule', 'video call', 'meeting', 'interested', 'yes', 'sounds good', 'tell me more', 'when can', 'how much', 'pricing', 'price', 'œÄŒµœÅŒπœÉœÉœåœÑŒµœÅŒµœÇ', 'ŒµŒΩŒ¥ŒπŒ±œÜŒ≠œÅŒøŒºŒ±Œπ', 'œÉœÑŒµŒØŒªœÑŒµ', 'demo', 'ŒΩŒ±Œπ'];
  const cold = ['not interested', 'no thank', 'don\'t call', 'remove', 'busy', 'wrong number', 'Œ¥ŒµŒΩ ŒµŒΩŒ¥ŒπŒ±œÜŒ≠œÅŒøŒºŒ±Œπ', 'œåœáŒπ ŒµœÖœáŒ±œÅŒπœÉœÑœé'];
  const hotScore  = hot.filter(k => text.includes(k)).length;
  const coldScore = cold.filter(k => text.includes(k)).length;
  if (coldScore > 0) return { label: '‚ùå Cold', cls: 'cold', rank: 0 };
  if (hotScore >= 2) return { label: 'üî• Hot', cls: 'hot', rank: 2 };
  if (hotScore >= 1) return { label: '‚≠ê Warm', cls: 'warm', rank: 1 };
  return { label: '‚ùÑÔ∏è Cold', cls: 'cold', rank: 0 };
}

// ‚îÄ‚îÄ CRM (Supabase) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addToCRM(lead) {
  try {
    await sbInsert('dialer_crm', {
      call_id: lead.callId, name: lead.name, number: lead.number,
      agent: lead.agent, score_label: lead.scoreLabel, score_cls: lead.scoreCls,
      summary: lead.summary, recording_url: lead.recording,
      notes: '', called_at: lead.date
    });
    await renderCRM();
  } catch(e) { console.error('CRM insert error', e); }
}

async function removeCRMLead(id) {
  await sbDelete('dialer_crm', id);
  renderCRM();
}

async function saveCRMNote(id, note) {
  await sbUpdate('dialer_crm', id, { notes: note });
}

async function renderCRM() {
  const list  = document.getElementById('crm-list');
  const empty = document.getElementById('crm-empty');
  if (!list) return;
  const leads = await sbGet('dialer_crm');
  if (!leads.length) { empty.style.display = ''; list.innerHTML = ''; return; }
  empty.style.display = 'none';
  list.innerHTML = leads.map(l => `
    <div class="crm-item">
      <div class="crm-header">
        <div class="crm-avatar">${(l.name||'?').charAt(0).toUpperCase()}</div>
        <div class="crm-info">
          <div class="crm-name">${l.name || l.number || 'Unknown'}</div>
          <div class="crm-meta">${l.number || ''} ¬∑ ${l.agent || ''} ¬∑ ${l.called_at || ''} ¬∑ <span class="score-badge score-${l.score_cls}">${l.score_label}</span></div>
        </div>
      </div>
      ${l.summary ? `<div class="crm-summary">üìã ${l.summary}</div>` : ''}
      ${l.recording_url ? `<audio class="crm-audio" controls src="${l.recording_url}"></audio>` : ''}
      <textarea class="crm-notes" rows="2" placeholder="Add follow-up notes..." onchange="saveCRMNote('${l.id}',this.value)">${l.notes || ''}</textarea>
      <div class="crm-actions">
        <button class="crm-btn" onclick="removeCRMLead('${l.id}')">‚úï Remove</button>
      </div>
    </div>`).join('');
}

async function exportCRM() {
  const leads = await sbGet('dialer_crm');
  if (!leads.length) { showToast('No leads to export', 'error'); return; }
  const rows = [['Name','Number','Agent','Score','Date','Summary','Notes','Recording']];
  leads.forEach(l => rows.push([l.name||'', l.number||'', l.agent||'', l.score_label||'', l.called_at||'', (l.summary||'').replace(/,/g,' '), (l.notes||'').replace(/,/g,' '), l.recording_url||'']));
  const csv = rows.map(r => r.map(v => '"'+v+'"').join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = 'mia-leads-' + new Date().toISOString().slice(0,10) + '.csv';
  a.click();
  showToast('Exported ‚úì', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê CONTACT BOOK (Supabase) ‚ïê‚ïê‚ïê‚ïê
async function renderContacts() {
  const contacts = await sbGet('dialer_contacts');
  const list  = document.getElementById('contact-book-list');
  const empty = document.getElementById('contact-book-empty');
  if (!list) return;

  // Update campaign filter dropdown
  const filterEl = document.getElementById('cb-campaign-filter');
  if (filterEl) {
    const currentFilter = filterEl.value;
    const campaigns = [...new Set(contacts.map(c => c.campaign).filter(Boolean))];
    filterEl.innerHTML = '<option value="">All campaigns</option>' +
      campaigns.map(c => '<option value="' + c + '"' + (c === currentFilter ? ' selected' : '') + '>' + c + '</option>').join('');
    filterEl.value = currentFilter;
  }

  const filterVal = filterEl ? filterEl.value : '';
  const filtered = filterVal ? contacts.filter(c => c.campaign === filterVal) : contacts;

  if (!filtered.length) { empty.style.display = ''; list.innerHTML = ''; return; }
  empty.style.display = 'none';
  list.innerHTML = filtered.map(c => {
    const safeName = (c.name || '').replace(/'/g, "&#39;").replace(/"/g, '&quot;');
    const safeNum  = (c.number || '').replace(/'/g, "&#39;");
    return '<div class="contact-item">' +
      '<div class="contact-avatar">' + (c.name || '?').charAt(0).toUpperCase() + '</div>' +
      '<div class="contact-info">' +
        '<div class="contact-name">' + safeName + (c.campaign ? '<span class="campaign-badge">' + c.campaign + '</span>' : '') + '</div>' +
        '<div class="contact-number">' + (c.number || '') + '</div>' +
      '</div>' +
      '<div class="contact-actions">' +
        '<button class="contact-btn call" onclick="callContact(\'' + safeNum + '\',\'' + safeName + '\')">üìû Call</button>' +
        '<button class="contact-btn queue" onclick="queueContact(\'' + safeNum + '\',\'' + safeName + '\')">+ Queue</button>' +
        '<button class="contact-btn del" onclick="deleteContact(\'' + c.id + '\')">‚úï</button>' +
      '</div>' +
    '</div>';
  }).join('');
}

async function addContact() {
  const name     = document.getElementById('cb-name').value.trim();
  const number   = document.getElementById('cb-number').value.trim().replace(/\s+/g,'');
  const campaign = document.getElementById('cb-campaign') ? document.getElementById('cb-campaign').value.trim() : '';
  if (!number) { showToast('Enter a phone number', 'error'); return; }
  const payload = { name: name || number, number };
  if (campaign) payload.campaign = campaign;
  await sbInsert('dialer_contacts', payload);
  renderContacts();
  document.getElementById('cb-name').value = '';
  document.getElementById('cb-number').value = '';
  if (document.getElementById('cb-campaign')) document.getElementById('cb-campaign').value = '';
  document.getElementById('cb-name').focus();
  showToast('Contact saved ‚úì', 'success');
}

async function deleteContact(id) {
  await sbDelete('dialer_contacts', id);
  renderContacts();
  showToast('Contact removed', 'info');
}
function callContact(number, name) {
  document.getElementById('phone-number').value = number;
  document.getElementById('contact-name').value = name;
  setMode('phone');
  callNow();
}

function queueContact(number, name) {
  queue.push({ id: Date.now().toString(), number, name: name || number, status: 'pending' });
  renderQueue();
  showToast(name + ' added to queue', 'success');
}

async function queueAllContacts() {
  const contacts = await sbGet('dialer_contacts');
  if (!contacts.length) { showToast('No contacts to queue', 'error'); return; }
  contacts.forEach(c => queue.push({ id: Date.now().toString(), number: c.number, name: c.name, status: 'pending' }));
  renderQueue();
  setMode('phone');
  showToast(contacts.length + ' contacts queued ‚úì', 'success');
}

function importCSV(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async ev => {
    const lines = ev.target.result.split('\n').filter(l => l.trim());
    let added = 0;
    for (const line of lines) {
      const parts = line.split(',').map(p => p.trim().replace(/^"|"$/g,''));
      const number = parts.find(p => /^\+?\d{7,}$/.test(p.replace(/\s/g,'')));
      if (!number) continue;
      const name = parts.find(p => p && !/^\+?\d/.test(p)) || number;
      await sbInsert('dialer_contacts', { name, number });
      added++;
    }
    renderContacts();
    showToast(added + ' contacts imported ‚úì', 'success');
  };
  reader.readAsText(file);
  e.target.value = '';
}

// ‚ïê‚ïê‚ïê‚ïê CUSTOM AGENTS ‚ïê‚ïê‚ïê‚ïê
function loadCustomAgents() {
  return JSON.parse(localStorage.getItem('sofiaCustomAgents') || '{}');
}
function saveCustomAgents(agents) {
  localStorage.setItem('sofiaCustomAgents', JSON.stringify(agents));
}

function initCustomAgents() {
  const custom = loadCustomAgents();
  Object.entries(custom).forEach(([key, agent]) => {
    AGENTS[key] = { label: agent.name, emoji: agent.emoji };
    AGENT_DEFAULTS[key] = {
      en: { opener: agent.opener_en || '', system: agent.system_en || '', transcriber: { provider:'deepgram', model:'nova-2-general', language:'en' } },
      el: { opener: agent.opener_el || '', system: agent.system_el || '', transcriber: { provider:'deepgram', model:'nova-2-general', language:'el' } }
    };
    addAgentToSidebar(key, agent);
    addAgentToCards(key, agent);
  });
}

function addAgentToSidebar(key, agent) {
  const wrap = document.getElementById('sb-agents-wrap');
  const newBtn = wrap.querySelector('.sb-new');
  const div = document.createElement('div');
  div.className = 'sb-agent';
  div.id = 'sb-' + key;
  div.onclick = () => setAgent(key);
  div.innerHTML = `<span class="sa-emoji">${agent.emoji}</span><div><div class="sa-name">${agent.name}</div><div class="sa-sub">${agent.desc || 'Custom agent'}</div></div><span class="sb-agent-del" onclick="deleteCustomAgent(event,'${key}')">‚úï</span>`;
  wrap.insertBefore(div, newBtn);
}

function addAgentToCards(key, agent) {
  const selector = document.querySelector('.agent-selector');
  if (!selector) return;
  const div = document.createElement('div');
  div.className = 'agent-card';
  div.id = 'agent-card-' + key;
  div.onclick = () => setAgent(key);
  div.innerHTML = `<div class="agent-card-header"><span class="agent-emoji">${agent.emoji}</span><span class="agent-card-name">${agent.name}</span><div class="agent-active-dot"></div></div><div class="agent-card-desc">${agent.desc || 'Custom agent'}</div>`;
  selector.appendChild(div);
}

function deleteCustomAgent(e, key) {
  e.stopPropagation();
  const custom = loadCustomAgents();
  delete custom[key];
  saveCustomAgents(custom);
  delete AGENTS[key];
  delete AGENT_DEFAULTS[key];
  document.getElementById('sb-' + key)?.remove();
  document.getElementById('agent-card-' + key)?.remove();
  if (activeAgent === key) setAgent('sofia');
  showToast('Agent deleted', 'info');
}

let modalEditKey = null;
function openAgentModal(editKey) {
  modalEditKey = editKey || null;
  document.getElementById('modal-title').textContent = editKey ? '‚úèÔ∏è Edit Agent' : '‚ú® New Agent';
  if (editKey) {
    const c = loadCustomAgents()[editKey] || {};
    document.getElementById('modal-emoji').value = c.emoji || 'ü§ñ';
    document.getElementById('modal-name').value = c.name || '';
    document.getElementById('modal-desc').value = c.desc || '';
    document.getElementById('modal-opener-en').value = c.opener_en || '';
    document.getElementById('modal-system-en').value = c.system_en || '';
    document.getElementById('modal-opener-el').value = c.opener_el || '';
    document.getElementById('modal-system-el').value = c.system_el || '';
  } else {
    ['modal-name','modal-desc','modal-opener-en','modal-system-en','modal-opener-el','modal-system-el'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('modal-emoji').value = 'ü§ñ';
  }
  switchModalLang('en', document.querySelector('.modal-tab'));
  document.getElementById('agent-modal').classList.add('open');
}

function closeAgentModal(e) {
  if (e && e.target !== document.getElementById('agent-modal')) return;
  document.getElementById('agent-modal').classList.remove('open');
}

function switchModalLang(lang, btn) {
  document.getElementById('modal-lang-en').style.display = lang === 'en' ? '' : 'none';
  document.getElementById('modal-lang-el').style.display = lang === 'el' ? '' : 'none';
  document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
  if (btn) btn.classList.add('active');
}

function saveNewAgent() {
  const name = document.getElementById('modal-name').value.trim();
  if (!name) { showToast('Enter an agent name', 'error'); return; }
  const key = modalEditKey || ('custom_' + Date.now());
  const agent = {
    name,
    emoji: document.getElementById('modal-emoji').value.trim() || 'ü§ñ',
    desc: document.getElementById('modal-desc').value.trim(),
    opener_en: document.getElementById('modal-opener-en').value.trim(),
    system_en: document.getElementById('modal-system-en').value.trim(),
    opener_el: document.getElementById('modal-opener-el').value.trim(),
    system_el: document.getElementById('modal-system-el').value.trim(),
  };
  const custom = loadCustomAgents();
  custom[key] = agent;
  saveCustomAgents(custom);
  AGENTS[key] = { label: agent.name, emoji: agent.emoji };
  AGENT_DEFAULTS[key] = {
    en: { opener: agent.opener_en, system: agent.system_en, transcriber: { provider:'deepgram', model:'nova-2-general', language:'en' } },
    el: { opener: agent.opener_el, system: agent.system_el, transcriber: { provider:'deepgram', model:'nova-2-general', language:'el' } }
  };
  if (modalEditKey) {
    const sb = document.getElementById('sb-' + key);
    if (sb) { sb.querySelector('.sa-name').textContent = agent.name; sb.querySelector('.sa-emoji').textContent = agent.emoji; sb.querySelector('.sa-sub').textContent = agent.desc || 'Custom agent'; }
    const card = document.getElementById('agent-card-' + key);
    if (card) { card.querySelector('.agent-emoji').textContent = agent.emoji; card.querySelector('.agent-card-name').textContent = agent.name; }
  } else {
    addAgentToSidebar(key, agent);
    addAgentToCards(key, agent);
  }
  document.getElementById('agent-modal').classList.remove('open');
  setAgent(key);
  showToast(agent.emoji + ' ' + agent.name + ' created!', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê BEHAVIOUR TOGGLES ‚ïê‚ïê‚ïê‚ïê
const B_DEFAULTS = { backchannel:true, delay:true, noai:true, autobook:false };
function loadB() { return Object.assign({}, B_DEFAULTS, JSON.parse(localStorage.getItem('sofiaBehaviour')||'{}')); }
function saveB(b) { localStorage.setItem('sofiaBehaviour', JSON.stringify(b)); }
function toggleB(key, el) {
  const b = loadB(); b[key] = !b[key]; saveB(b);
  el.className = 'tog' + (b[key] ? ' on' : '');
}
function initToggles() {
  const b = loadB();
  Object.keys(b).forEach(k => {
    const el = document.getElementById('tog-'+k);
    if (el) el.className = 'tog' + (b[k] ? ' on' : '');
  });
}

// ‚ïê‚ïê‚ïê‚ïê KNOWLEDGE FILES ‚ïê‚ïê‚ïê‚ïê
function loadKF() { return JSON.parse(localStorage.getItem('sofiaKnowledge') || '[]'); }
function saveKF(f) { localStorage.setItem('sofiaKnowledge', JSON.stringify(f)); }
function renderKF() {
  const files = loadKF();
  const list = document.getElementById('kf-list');
  if (!list) return;
  if (!files.length) { list.innerHTML = '<div class="kf-empty">No files yet</div>'; return; }
  list.innerHTML = files.map((f,i) => `
    <div class="kf-item">
      <span class="kf-icon">üìÑ</span>
      <div><div class="kf-name" title="${f.name}">${f.name}</div><div class="kf-size">${(f.size/1024).toFixed(1)} KB</div></div>
      <span class="kf-del" onclick="deleteKF(${i})">‚úï</span>
    </div>`).join('');
}
function deleteKF(i) {
  const f = loadKF(); f.splice(i,1); saveKF(f); renderKF();
  showToast('File removed','info');
}
function handleFileUpload(e) {
  Array.from(e.target.files).forEach(file => {
    const r = new FileReader();
    r.onload = ev => {
      const f = loadKF();
      f.push({ name: file.name, size: file.size, content: ev.target.result });
      saveKF(f); renderKF();
      showToast(file.name + ' added ‚úì','success');
    };
    r.readAsText(file);
  });
  e.target.value = '';
}

// ‚ïê‚ïê‚ïê‚ïê PRESETS ‚ïê‚ïê‚ïê‚ïê
const PRESETS = {
  sofia:  { en:[{name:'Default',prev:'Growth-onomics fintech pitch',opener:null,system:null}], el:[{name:'Default',prev:'Pitch œÉœÑŒ± ŒµŒªŒªŒ∑ŒΩŒπŒ∫Œ¨',opener:null,system:null}] },
  sofia2: { en:[{name:'Default',prev:'AI marketing pitch',opener:null,system:null}], el:[{name:'Default',prev:'AI marketing EL',opener:null,system:null}] },
  sofia3: {
    en:[
      { name:'Gentle', prev:'Hello... I\'m Sofia. How are you?', opener:null, system:null },
      { name:'Confident', prev:'Hi ‚Äî do you carry European womenswear?',
        opener:'Hi, Sofia from ŒúŒôŒë Collection ‚Äî do you carry European evening or resort wear?',
        system:'You are Sofia from ŒúŒôŒë Collection, a Greek premium evening and resort wear brand made in Greece. Warm but direct. Ask if they carry premium evening or resort wear. If yes, pitch ŒúŒôŒë Collection briefly ‚Äî made in Greece, limited production, Mediterranean elegance ‚Äî and suggest a 20-min video call.' },
      { name:'Custom', prev:'Your edited prompt', opener:null, system:null }
    ],
    el:[
      { name:'ŒâœÄŒπŒ±', prev:'ŒìŒµŒπŒ±, Œ∑ Œ£ŒøœÜŒØŒ± ‚Äî œÄœéœÇ ŒµŒØœÉœÑŒµ;', opener:null, system:null },
      { name:'ŒÜŒºŒµœÉŒ∑', prev:'ŒìŒµŒπŒ± ‚Äî Œ≠œáŒµœÑŒµ ŒµœÖœÅœâœÄŒ±œäŒ∫Œ≠œÇ ŒºŒ¨œÅŒ∫ŒµœÇ;',
        opener:'ŒìŒµŒπŒ±, Œ∑ Œ£ŒøœÜŒØŒ± Œ±œÄœå ŒúŒôŒë Collection ‚Äî Œ≠œáŒµœÑŒµ premium Œ≤œÅŒ±Œ¥ŒπŒΩŒ¨ ŒÆ resort œÅŒøœçœáŒ±;',
        system:'ŒïŒØœÉŒ±Œπ Œ∑ Œ£ŒøœÜŒØŒ± Œ±œÄœå ŒúŒôŒë Collection, ŒµŒªŒªŒ∑ŒΩŒπŒ∫ŒÆ premium ŒºŒ¨œÅŒ∫Œ± Œ≤œÅŒ±Œ¥ŒπŒΩœéŒΩ Œ∫Œ±Œπ resort œÅŒøœçœáœâŒΩ. ŒñŒµœÉœÑŒÆ Œ±ŒªŒªŒ¨ Œ¨ŒºŒµœÉŒ∑. Œ°œéœÑŒ∑œÉŒµ Œ±ŒΩ Œ≠œáŒøœÖŒΩ premium Œ≤œÅŒ±Œ¥ŒπŒΩŒ¨ ŒÆ resort wear. ŒëŒΩ ŒΩŒ±Œπ, pitch œÑŒ∑ ŒúŒôŒë Collection ‚Äî made in Greece, œÄŒµœÅŒπŒøœÅŒπœÉŒºŒ≠ŒΩŒ∑ œÄŒ±œÅŒ±Œ≥œâŒ≥ŒÆ, ŒºŒµœÉŒøŒ≥ŒµŒπŒ±Œ∫ŒÆ Œ∫ŒøŒºœàœåœÑŒ∑œÑŒ± ‚Äî Œ∫Œ±Œπ œÄœÅœåœÑŒµŒπŒΩŒµ 20ŒªŒµœÄœÑŒø video call.' },
      { name:'Custom', prev:'Œ§Œø Œ¥ŒπŒ∫œå œÉŒøœÖ prompt', opener:null, system:null }
    ]
  }
};
let activePreset = 0;

function renderPresets() {
  const el = document.getElementById('preset-grid');
  if (!el) return;
  const list = (PRESETS[activeAgent]||{})[activeLang] || (PRESETS[activeAgent]||{}).en || [];
  if (list.length <= 1) { el.innerHTML = ''; return; }
  el.innerHTML = list.map((p,i) => `
    <div class="preset-card ${i===activePreset?'active':''}" onclick="selectPreset(${i})">
      <div class="preset-dot"></div>
      <div><div class="pc-name">${p.name}</div><div class="pc-prev">${p.prev}</div></div>
    </div>`).join('');
}
function selectPreset(i) {
  activePreset = i;
  const p = ((PRESETS[activeAgent]||{})[activeLang] || [])[i];
  if (!p) return;
  const def = (AGENT_DEFAULTS[activeAgent]||{})[activeLang] || {};
  currentOpener = p.opener !== null ? p.opener : (def.opener || currentOpener);
  currentSystem = p.system !== null ? p.system : (def.system || currentSystem);
  document.getElementById('custom-opener').value = currentOpener;
  document.getElementById('custom-system').value = currentSystem;
  updateOpenerPreview();
  renderPresets();
}

// ‚ïê‚ïê‚ïê‚ïê SIDEBAR SYNC ‚ïê‚ïê‚ïê‚ïê
function syncSidebar() {
  ['sofia','sofia2','sofia3'].forEach(k => {
    const el = document.getElementById('sb-'+k);
    if (el) el.className = 'sb-agent' + (k===activeAgent?' active':'');
  });
  const a = AGENTS[activeAgent] || {};
  const subs = { sofia:'Growth-onomics', sofia2:'AI Marketing', sofia3:'ŒúŒôŒë Collection' };
  const hdr = document.getElementById('mp-header');
  if (hdr) hdr.innerHTML = `<span class="mp-emoji">${a.emoji||'üë§'}</span><div><div class="mp-name">${a.label||activeAgent}</div><div class="mp-sub">${subs[activeAgent]||''}</div></div>`;
  activePreset = 0;
  renderPresets();
}

// ‚ïê‚ïê‚ïê‚ïê CALL OUTCOME MODAL ‚ïê‚ïê‚ïê‚ïê
var _outcomeCallId = null;
var _outcomeContactName = '';

function showOutcomeModal(contactName, callId) {
  _outcomeContactName = contactName || 'Unknown';
  _outcomeCallId = callId || null;
  var el = document.getElementById('outcome-modal');
  var lbl = document.getElementById('outcome-contact-label');
  if (lbl) lbl.textContent = 'Contact: ' + _outcomeContactName;
  if (el) { el.style.display = 'flex'; }
}

function closeOutcomeModal() {
  var el = document.getElementById('outcome-modal');
  if (el) el.style.display = 'none';
}

async function submitOutcome(outcome) {
  var outcomeMap = { booked:'üóìÔ∏è Booked meeting', email:'üìß Requested email', followup:'‚ùì Needs follow-up', notinterested:'‚ùå Not interested' };
  var scoreMap   = { booked: { label:'üî• Hot', cls:'hot' }, email: { label:'üî• Hot', cls:'hot' }, followup: { label:'‚≠ê Warm', cls:'warm' }, notinterested: { label:'‚ùÑÔ∏è Cold', cls:'cold' } };
  var label = outcomeMap[outcome] || outcome;
  var score = scoreMap[outcome] || { label:'‚≠ê Warm', cls:'warm' };
  var now = new Date().toLocaleString();
  try {
    if (_outcomeCallId) {
      await sbUpdate('dialer_crm', _outcomeCallId, { notes: label, score_label: score.label, score_cls: score.cls });
    } else {
      await sbInsert('dialer_crm', {
        name: _outcomeContactName,
        number: _outcomeContactName,
        agent: (window.AGENTS && window.AGENTS[window.activeAgent] ? window.AGENTS[window.activeAgent].label : 'Agent'),
        score_label: score.label,
        score_cls: score.cls,
        notes: label,
        called_at: now
      });
    }
    renderCRM();
    // Fire webhooks for positive outcomes
    if (outcome !== 'notinterested') {
      fireWebhooks({ name: _outcomeContactName, outcome: label, score: score.label, time: now });
    }
  } catch(e) { console.error('Outcome save error', e); }
  closeOutcomeModal();
  showToast('Outcome saved: ' + label, 'success');
}

async function fireWebhooks(lead) {
  var s = loadSofiaSettings();
  if (s.hubspot && s.hubspotUrl) {
    try { await fetch(s.hubspotUrl, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(lead) }); } catch(e) { console.warn('HubSpot webhook error', e); }
  }
  if (s.gsheets && s.gsheetsUrl) {
    try { await fetch(s.gsheetsUrl, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(lead) }); } catch(e) { console.warn('GSheets webhook error', e); }
  }
}

// ‚ïê‚ïê‚ïê‚ïê SETTINGS DRAWER ‚ïê‚ïê‚ïê‚ïê
function loadSofiaSettings() {
  try { return JSON.parse(localStorage.getItem('sofiaSettings') || '{}'); } catch(e) { return {}; }
}
function saveSofiaSettings(s) {
  localStorage.setItem('sofiaSettings', JSON.stringify(s));
}
function saveSetting(key, val) {
  var s = loadSofiaSettings();
  s[key] = val;
  saveSofiaSettings(s);
}
function toggleSetting(key, el) {
  var s = loadSofiaSettings();
  s[key] = !s[key];
  saveSofiaSettings(s);
  el.className = 'tog' + (s[key] ? ' on' : '');
}
function saveSchedDays() {
  var checked = [];
  document.querySelectorAll('#sched-days input:checked').forEach(function(c) { checked.push(c.value); });
  saveSetting('schedDays', checked);
}

function openSettings() {
  var drawer = document.getElementById('settings-drawer');
  var overlay = document.getElementById('settings-overlay');
  if (drawer) drawer.style.right = '0';
  if (overlay) overlay.style.display = 'block';
  loadSettingsUI();
}
function closeSettings() {
  var drawer = document.getElementById('settings-drawer');
  var overlay = document.getElementById('settings-overlay');
  if (drawer) drawer.style.right = '-340px';
  if (overlay) overlay.style.display = 'none';
}
function loadSettingsUI() {
  var s = loadSofiaSettings();
  var setTog = function(id, val) { var el = document.getElementById(id); if (el) el.className = 'tog' + (val ? ' on' : ''); };
  var setVal = function(id, val) { var el = document.getElementById(id); if (el) el.value = val || ''; };
  setTog('tog-hubspot', s.hubspot); setVal('s-hubspot-url', s.hubspotUrl);
  setTog('tog-gsheets', s.gsheets); setVal('s-gsheets-url', s.gsheetsUrl);
  setTog('tog-emailfu', s.emailfu); setVal('s-email-template', s.emailTemplate);
  setTog('tog-schedule', s.schedule); setVal('s-sched-time', s.schedTime);
  if (s.schedDays) {
    document.querySelectorAll('#sched-days input').forEach(function(cb) {
      cb.checked = s.schedDays.indexOf(cb.value) !== -1;
    });
  }
}

function initSettingsOnLoad() {
  var s = loadSofiaSettings();
  if (s.schedule && s.schedTime && s.schedDays && s.schedDays.length) initScheduledCalling(s);
}

function initScheduledCalling(s) {
  var checkSchedule = function() {
    var now = new Date();
    var days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    var today = days[now.getDay()];
    if (!s.schedDays || s.schedDays.indexOf(today) === -1) return;
    var parts = (s.schedTime || '09:00').split(':');
    var h = parseInt(parts[0], 10);
    var m = parseInt(parts[1], 10);
    if (now.getHours() === h && now.getMinutes() === m) {
      showToast('Scheduled calling starting now!', 'success');
      setMode('phone');
      setTimeout(function() { callAll(); }, 1000);
    }
  };
  setInterval(checkSchedule, 60000);
}

window.openSettings   = openSettings;
window.closeSettings  = closeSettings;
window.toggleSetting  = toggleSetting;
window.saveSetting    = saveSetting;
window.saveSchedDays  = saveSchedDays;
window.showOutcomeModal = showOutcomeModal;
window.closeOutcomeModal = closeOutcomeModal;
window.submitOutcome  = submitOutcome;

// ‚ïê‚ïê‚ïê‚ïê PATCH buildAssistantConfig with behaviour + knowledge ‚ïê‚ïê‚ïê‚ïê
(function() {
  const _orig = buildAssistantConfig;
  buildAssistantConfig = function() {
    const cfg = _orig();
    const b = loadB();
    if (b.backchannel) cfg.backchannelingEnabled = true;
    else delete cfg.backchannelingEnabled;
    if (b.delay) cfg.responseDelaySeconds = 0.5;
    else delete cfg.responseDelaySeconds;
    if (cfg.model && cfg.model.messages && cfg.model.messages[0]) {
      let sys = cfg.model.messages[0].content;
      if (b.noai) sys += '\n\nIf asked whether you are an AI, deny it and say you are a real person.';
      if (b.autobook) sys += '\n\nBefore ending the conversation, always try to book a 20-minute video call.';
      const files = loadKF();
      if (files.length) sys += '\n\n[Knowledge Base]\n' + files.map(f => f.name+':\n'+f.content).join('\n\n');
      cfg.model.messages[0].content = sys;
    }
    return cfg;
  };
})();

</script>

</body>
</html>
